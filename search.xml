<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
    
    <entry>
      <title><![CDATA[CAS中的遇到的一些问题]]></title>
      <url>http://twogoods.github.io/2017/05/14/CAS/</url>
      <content type="html"><![CDATA[<p>看并发看到了无锁的CAS，都说无锁没有锁竞争带来的开销，也没有线程间频繁调度的开销，比基于锁的方式有更好的性能。小白看了很激动，这么好的工具赶紧用起来。于是想试着把以前的一段并发代码改一改。<a id="more"></a></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BenchController</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Random random = <span class="keyword">new</span> Random();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Object[] lockObj;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> AtomicReference&lt;Integer&gt;[] locks;</span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        lockObj = <span class="keyword">new</span> Object[<span class="number">100</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; lockObj.length; i++) &#123;</span><br><span class="line">            lockObj[i] = <span class="keyword">new</span> Object();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        locks = <span class="keyword">new</span> AtomicReference[<span class="number">100</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; locks.length; i++) &#123;</span><br><span class="line">            locks[i] = <span class="keyword">new</span> AtomicReference&lt;Integer&gt;(<span class="keyword">null</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"a/&#123;id&#125;"</span>)</span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">a</span><span class="params">(@PathVariable(<span class="string">"id"</span>)</span> <span class="keyword">int</span> id) <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">long</span> start = System.currentTimeMillis();</span><br><span class="line">        <span class="keyword">int</span> index = id % <span class="number">100</span>;</span><br><span class="line">        <span class="keyword">long</span> inner = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">synchronized</span> (lockObj[index]) &#123;</span><br><span class="line">            inner = test();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">long</span> result = System.currentTimeMillis() - start;</span><br><span class="line">        System.out.println(<span class="string">"all: "</span> + result + <span class="string">" inner: "</span> + inner);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"b/&#123;id&#125;"</span>)</span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">b</span><span class="params">(@PathVariable(<span class="string">"id"</span>)</span> <span class="keyword">int</span> id) <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">long</span> start = System.currentTimeMillis();</span><br><span class="line">        id = id % <span class="number">100</span>;</span><br><span class="line">        AtomicReference&lt;Integer&gt; lock = locks[id];</span><br><span class="line">        <span class="keyword">int</span> b = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (!lock.compareAndSet(<span class="keyword">null</span>, id)) &#123;</span><br><span class="line">            b = <span class="number">1</span> + <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">long</span> inner = test();</span><br><span class="line">        <span class="keyword">boolean</span> flag = lock.compareAndSet(id, <span class="keyword">null</span>);</span><br><span class="line">        <span class="keyword">long</span> result = System.currentTimeMillis() - start;</span><br><span class="line">        System.out.println(<span class="string">"all: "</span> + result + <span class="string">" inner: "</span> + inner + <span class="string">" flag:"</span> + flag);</span><br><span class="line">        System.out.println(b);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">test</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">long</span> innerstart = System.currentTimeMillis();</span><br><span class="line">        Thread.sleep(<span class="number">200</span>);</span><br><span class="line">        System.out.println(System.currentTimeMillis() - innerstart);</span><br><span class="line">        <span class="keyword">return</span> System.currentTimeMillis() - innerstart;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>代码的场景很简单，多个用户可能对一个id的订单做操作，而业务上只能有一个用户操作成功，当初实现的时候用的<code>a()</code>方法，基于无锁的思路我添加了b。用Jmeter每秒发20个同id的请求，结果很意外，有锁代码明显好于无锁的代码。当然这绝不是一个靠谱的性能测试办法，但这也抛给我一个问题，无锁不是号称性能很好嘛，为什么这里这么差？再往下走我发现了一个怪异的问题，在使用无锁的情况下我特地独立出来的<code>test()</code>里打印的睡眠时间和200毫秒相差巨大…这里非常的怪异，sleep有几个毫秒的误差是正常的，然而实际的误差有的实在太大。花了很长时间，问了问别人，我发现了这其中的一些问题：在我的机器上每秒20个线程请求无锁代码，我的cpu被占满了，再仔细想一想就会发现CAS操作虽然免去了线程调度的开销，然而不能忽略它不断尝试直到成功的那段死循环对CPU负载的影响，CAS下的所有线程都是活跃线程（这里可以联系一下JVM锁优化里的自旋锁，线程没拿到锁不会马上挂起，而是自旋等待一会儿，如果这时拿到锁就省去了线程调度的开销）。回到这个例子当中，200毫秒的睡眠不是一个短的时间，每秒20个请求远远超出了处理能力，有大量的线程占用着“无意义”的CPU计算资源。</p>
<p>后来我又看到了这篇讨论AtomicInteger的<a href="http://ifeve.com/enhanced-cas-in-jdk8/" target="_blank" rel="external">文章</a>,文中显式的调用<code>compareAndSet()</code>方法，结果是不如<code>synchronized</code>来的好。当然我已经不止一次被告知在测试细微性能差别的时候Main方法往往是不靠谱的,那应该怎么测试呢？jmh。</p>
<h2 id="jmh"><a href="#jmh" class="headerlink" title="jmh"></a>jmh</h2><p>编写测试代码，使用注解，然后jmh完成剩下一切。<br>Mode:</p>
<ul>
<li>Mode.Throughput 指定多少次迭代，计算总时间 op/s</li>
<li>Mode.AverageTime 方法执行的平均时间 op/s</li>
<li>Mode.SampleTime 不测量总时间，测量某一部分调用的时间，所以结果中你能看到 p0.5，p0.9</li>
<li>Mode.SingleShotTime 每次迭代只执行一次</li>
</ul>
<p>state:</p>
<ul>
<li>Scope.Thread:线程私有</li>
<li>Scope.Benchmark：线程共享</li>
</ul>
<p>Dead-Code Elimination (DCE)</p>
<pre><code>@Benchmark
public double measureWrong() {
    Math.log(x1);//注意编译器优化，这一行无意义，会被优化掉，使用后面两种方式
    return Math.log(x2);
}
@Benchmark
public double measureRight_1() {
    return Math.log(x1) + Math.log(x2);
}
@Benchmark
public void measureRight_2(Blackhole bh) {
    bh.consume(Math.log(x1));
    bh.consume(Math.log(x2));
}
--------------------------------------------
private double x = Math.PI;
private final double wrongX = Math.PI;
@Benchmark
public double measureWrong_1() {
    // 值被预测，不执行计算
    return Math.log(Math.PI);
}
@Benchmark
public double measureWrong_2() {
    // final类型依旧被优化
    return Math.log(wrongX);
}

@Benchmark
public double measureRight() {
    return Math.log(x);
}
</code></pre><h2 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h2><p>使用微基准测试框架JMH再测试一遍：</p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">@OutputTimeUnit</span>(TimeUnit.NANOSECONDS)</span><br><span class="line"><span class="variable">@Warmup</span>(iterations = <span class="number">5</span>)</span><br><span class="line"><span class="variable">@Measurement</span>(iterations = <span class="number">10</span>, time = <span class="number">5</span>, timeUnit = TimeUnit.SECONDS)</span><br><span class="line"><span class="variable">@BenchmarkMode</span>(Mode.AverageTime)</span><br><span class="line"><span class="variable">@State</span>(Scope.Benchmark)</span><br><span class="line">public class Test &#123;</span><br><span class="line">    private AtomicInteger atomic;</span><br><span class="line">    private Object lock = new Object();</span><br><span class="line">    private int i = 0;</span><br><span class="line">    <span class="variable">@Setup</span></span><br><span class="line">    public void setUp() &#123;</span><br><span class="line">        atomic = new AtomicInteger(0);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="variable">@Fork</span>(<span class="number">1</span>)</span><br><span class="line">    <span class="variable">@Threads</span>(<span class="number">10</span>)</span><br><span class="line">    <span class="variable">@Benchmark</span></span><br><span class="line">    public int incrementAtomic() &#123;</span><br><span class="line">        return atomic<span class="selector-class">.incrementAndGet</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="variable">@Fork</span>(<span class="number">1</span>)</span><br><span class="line">    <span class="variable">@Threads</span>(<span class="number">10</span>)</span><br><span class="line">    <span class="variable">@Benchmark</span></span><br><span class="line">    public int cas() &#123;</span><br><span class="line">        int i;</span><br><span class="line">        <span class="selector-tag">do</span> &#123;</span><br><span class="line">            i = atomic<span class="selector-class">.get</span>();</span><br><span class="line">        &#125; while (!atomic.compareAndSet(i, i + <span class="number">1</span>));</span><br><span class="line">        return i + 1;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="variable">@Fork</span>(<span class="number">1</span>)</span><br><span class="line">    <span class="variable">@Threads</span>(<span class="number">10</span>)</span><br><span class="line">    <span class="variable">@Benchmark</span></span><br><span class="line">    public int incrementSync() &#123;</span><br><span class="line">        <span class="selector-tag">synchronized</span> (lock) &#123;</span><br><span class="line">            ++i;</span><br><span class="line">        &#125;</span><br><span class="line">        return i;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">显式使用compareAndSet性能并不好，至于为什么，文末的讨论能提供一些帮助</span><br><span class="line">Benchmark             Mode  Cnt     Score    Error  Units</span><br><span class="line">Test<span class="selector-class">.cas</span>              avgt   <span class="number">10</span>  <span class="number">1071.773</span> ± <span class="number">21.083</span>  ns/op</span><br><span class="line">Test<span class="selector-class">.incrementAtomic</span>  avgt   <span class="number">10</span>   <span class="number">363.205</span> ±  <span class="number">1.198</span>  ns/op</span><br><span class="line">Test<span class="selector-class">.incrementSync</span>    avgt   <span class="number">10</span>   <span class="number">748.514</span> ±  <span class="number">8.889</span>  ns/op</span><br></pre></td></tr></table></figure>
<p>再给出最早的那个例子</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@OutputTimeUnit</span>(TimeUnit.NANOSECONDS)</span><br><span class="line"><span class="meta">@Warmup</span>(iterations = <span class="number">5</span>)</span><br><span class="line"><span class="meta">@Measurement</span>(iterations = <span class="number">10</span>, time = <span class="number">5</span>, timeUnit = TimeUnit.SECONDS)</span><br><span class="line"><span class="meta">@BenchmarkMode</span>(Mode.AverageTime)</span><br><span class="line"><span class="meta">@State</span>(Scope.Benchmark)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CASBench</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> count=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">private</span> Integer id=<span class="number">24</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Object[] lockObj;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> AtomicReference&lt;Integer&gt;[] locks;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Setup</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUp</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       lockObj = <span class="keyword">new</span> Object[<span class="number">100</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; lockObj.length; i++) &#123;</span><br><span class="line">            lockObj[i] = <span class="keyword">new</span> Object();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        locks = <span class="keyword">new</span> AtomicReference[<span class="number">100</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; locks.length; i++) &#123;</span><br><span class="line">            locks[i] = <span class="keyword">new</span> AtomicReference&lt;Integer&gt;(<span class="keyword">null</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Fork</span>(<span class="number">1</span>)</span><br><span class="line">    <span class="meta">@Threads</span>(<span class="number">10</span>)</span><br><span class="line">    <span class="meta">@Benchmark</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">sync</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> index = id % <span class="number">100</span>;</span><br><span class="line">        <span class="keyword">synchronized</span> (lockObj[index]) &#123;</span><br><span class="line">            count++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> count;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Fork</span>(<span class="number">1</span>)</span><br><span class="line">    <span class="meta">@Threads</span>(<span class="number">10</span>)</span><br><span class="line">    <span class="meta">@Benchmark</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">cas</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        AtomicReference&lt;Integer&gt; lock = locks[id % <span class="number">100</span>];</span><br><span class="line">        <span class="keyword">while</span> (!lock.compareAndSet(<span class="keyword">null</span>, id)) &#123;</span><br><span class="line">        &#125;</span><br><span class="line">        count++;</span><br><span class="line">        lock.compareAndSet(id, <span class="keyword">null</span>);</span><br><span class="line">        <span class="keyword">return</span> count;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">结果：</span><br><span class="line">Benchmark      Mode  Cnt     Score     Error  Units</span><br><span class="line">CASBench.cas   avgt   <span class="number">10</span>  <span class="number">3441.711</span> ± <span class="number">220.316</span>  ns/op</span><br><span class="line">CASBench.sync  avgt   <span class="number">10</span>   <span class="number">796.758</span> ±  <span class="number">26.033</span>  ns/op</span><br></pre></td></tr></table></figure>
<p>从结果中可以看到，文章开头的那个改造并不是一个好的选择。还是菜鸟，关于并发，CAS还是应该去多看看juc的代码。</p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[简单聊聊异步同步]]></title>
      <url>http://twogoods.github.io/2017/04/27/IO-Model/</url>
      <content type="html"><![CDATA[<p>我们先看一段伪代码：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">data = sql.query("<span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">table</span><span class="string">");//15毫秒</span><br><span class="line">count= sql.query("</span><span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">table</span><span class="string">");//10毫秒</span></span><br></pre></td></tr></table></figure>
<a id="more"></a>上面这段代码有两个耗时操作，他们顺序执行，完成需要25毫秒的时间，我们把这样的称为同步阻塞调用。<br><figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">future=executor.submit<span class="function"><span class="params">(()-&gt;sql.query(<span class="string">"select * from table"</span>))</span>;</span><br><span class="line"><span class="title">future2</span>=<span class="title">executor</span>.<span class="title">submit</span><span class="params">(()-&gt;sql.query(<span class="string">"select * from table"</span>))</span>;</span></span><br></pre></td></tr></table></figure>
<p>我们启用线程池，配合Future，<code>future.get()</code>会阻塞到操作完成，最终两个操作可以从25毫秒缩短到15毫秒，在实习当中不少同事就会把这样的代码叫做异步的，或许这样的说法久了大家就默认了，但这本质上不是异步。</p>
<h3 id="IO模型"><a href="#IO模型" class="headerlink" title="IO模型"></a>IO模型</h3><p>讲这个前自然要先说说阻塞与非阻塞，异步与同步。</p>
<blockquote>
<p>阻塞与非阻塞关注的是线程的状态，IO操作会不会把当前线程挂起。<br>同步和异步关注的是消息通知机制，调用者需不需要关注这个数据返回。</p>
</blockquote>
<p>以下是4种IO模型:</p>
<p><img src="http://oepm97cib.bkt.clouddn.com/io1.gif" alt=""><br><img src="http://oepm97cib.bkt.clouddn.com/io2.gif" alt=""><br><img src="http://oepm97cib.bkt.clouddn.com/io3.gif" alt=""><br><img src="http://oepm97cib.bkt.clouddn.com/io4.gif" alt=""></p>
<p>IO多路复用的一个好处就是以前多个用户线程的阻塞变为了一个线程上的阻塞，单个线程就可以同时处理多个网络连接的IO以支持大量的并发.虽然I/O多路复用的函数也是阻塞的，但I/O多路复用是阻塞在select，epoll这样的系统调用之上，而没有阻塞在真正的I/O系统调用如recvfrom之上。我们的NIO是同步非阻塞的，在IO多路复用那张图上我们看到我们还是主动发起系统调用将数据从内核拷贝到用户空间，这里就说明是同步的，此时的用户线程没有挂起。</p>
<p>推荐阅读:<br><a href="https://www.zhihu.com/question/27991975" target="_blank" rel="external">nio是同步非阻塞IO</a><br><a href="https://www.zhihu.com/question/19732473" target="_blank" rel="external">同步异步阻塞非阻塞</a><br><a href="http://blog.csdn.net/historyasamirror/article/details/5778378" target="_blank" rel="external">io模型</a></p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[mysql笔记]]></title>
      <url>http://twogoods.github.io/2017/04/11/mysql/</url>
      <content type="html"><![CDATA[<p>这两天在看大家都挺推荐的《Mysql技术内幕InnoDB存储引擎》以及其他几本相关的书中对锁，事务，sql调优的章节，对mysql有了更多的理解，零零散散的记一些。<a id="more"></a></p>
<h3 id="索引"><a href="#索引" class="headerlink" title="索引"></a>索引</h3><p>innodb按主键的顺序组织表，即按b+树组织。聚焦索引（可以简单理解为主键）；辅助索引，其叶子节点并不包含行记录的全部数据，叶子结点除了包含键值以外，每个叶子结点中的索引行还包含了一个书签，该书签用来告诉存储引擎可以在哪找到相应的数据行。一般情况下一条sql只能使用一个索引，多个优化器也只会选择最优的那个。</p>
<ul>
<li><strong>主键</strong>：非空的唯一索引，innodb里不指定也会自动生成一个6字节大小的指针。</li>
<li><strong>联合索引</strong>:会按索引字段的前后进行排序和索引，因此注意索引字段的顺序，如索引（A，B，C）<code>where A=? and B=? and C=?</code>可以利用索引，而<code>where B=? and C=?</code>无法利用，并且联合索引对于排序也有好处：<code>where A=? and B=? order by C</code>一样可以利用这个索引。<code>group by</code>的优化也类似。</li>
<li><strong>索引覆盖</strong>，简单理解就是你的select字段就是索引，那么就用到了索引覆盖。如<code>select id from T where name=&#39;twogoods&#39;</code>若<code>name</code>字段上有索引，我们的查询会走索引，在这个索引的叶子节点并不包含所有节点，但包含了找到具体数据的主键信息，这里我们只需要得到主键，因此这个索引的叶子节点上就已经提供了，无需去查找具体的数据行。对于索引覆盖形象点得说法是：我要在书里找一个内容，但是书的目录写的很详细，我通过书就找到了，那就无需去翻到具体的页查看了。</li>
</ul>
<h3 id="锁"><a href="#锁" class="headerlink" title="锁"></a>锁</h3><p>首先关于乐观锁，悲观锁，名字本身很形象了。乐观锁很乐观，每次去拿数据的时候都认为别人不会修改，所以不会上锁，但是在更新的时候会判断一下在此期间别人有没有去更新这个数据，可以使用版本号等机制。悲观锁很悲观，每次去拿数据的时候都认为别人会修改，所以每次在拿数据的时候都会上锁，这样别人想拿这个数据就会block直到它拿到锁。我们不显示指定事务时一条sql也是一个事务，一般来说锁是在整个事务执行完被释放，当然也可能因为不同的隔离级别而有所不同。<br>Innodb是行级锁，S Lock(共享锁)：允许事务读一行数据；X Lock(排他锁)：允许删除更新记录；S与X互斥，S与S兼容，X与X互斥。</p>
<ul>
<li>一致性非锁定读：通过多版本的方式来读取当前执行时间数据库中的数据。正在读取的行被执行update时不等行上锁的释放依然可以操作。</li>
<li>一致性锁定读：innodb默认的隔离级别是可重复读，select 时使用一致性非锁定读。如果读时不允许写需要显试加锁：<code>select ... for update</code> 这样对该行加X锁，其他事务对该行的读或写都阻塞；<code>select lock in share mode</code>加S锁，可以同时读，无法写。</li>
</ul>
<p>个人理解这两种方式就是乐观锁、悲观锁的具体实现；乐观锁在写时不加锁多个线程都可以写，有点像java数据结构里copyonwrite的机制。</p>
<h3 id="字段"><a href="#字段" class="headerlink" title="字段"></a>字段</h3><ul>
<li>tingyint 1个字节，-128~127；int 4字节 ；bigint8字节；注意取值范围合理选用。</li>
<li>datatime 8字节，timestamp 4字节，两者都精确到秒，考虑优先使用timestamp。</li>
<li>varchar 根据需要制定合适的长度，若在此字段上加索引，也注意要索引的长度，长20的索引区分度就能达到90%。</li>
</ul>
<h3 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h3><ul>
<li><strong>类型转换</strong>：字段是int的sql中可以使用String来查，只不过mysql帮我们做类型转换而已。</li>
<li><strong>like</strong>：由于b+树索引的结构，<code>like &quot;%a%&quot;</code>是无法通过索引查找的即不能左模糊，<code>like &quot;a%&quot;</code>是可以利用上索引的。不推荐使用<code>like</code>关键字，mysql也提供了全文检索的功能，对中文检索支持并不好，这里有一个中文检索<a href="http://mysqlserverteam.com/innodb%E5%85%A8%E6%96%87%E7%B4%A2%E5%BC%95%EF%BC%9An-gram-parser/" target="_blank" rel="external">插件</a>，不过感觉要上全文索引，好像都直接上搜索引擎了吧…</li>
<li><strong>limit</strong>：mysql offset并不会真正跳过这么多行，可以先快速定位获取id：<code>select * from T a,(select id from T limit 10000,20)b where a.id=b.id</code></li>
<li><strong>count</strong>：注意count(*)会统计该行为null的，count(列名)不会统计null；有时候也可以考虑count(辅助索引列)来加快查询。</li>
<li><strong>in</strong>：in里不要有太多的数据，如<code>id in (select id form T)</code>，我当初还犯过很二的错误，in里需要的数据在另一个数据库里来，没办法写到一个sql里，我查了几十万的id如果在sql里使用in，没多久程序就OOM了-_-……</li>
</ul>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[Java反射的一点总结]]></title>
      <url>http://twogoods.github.io/2017/04/05/reflection/</url>
      <content type="html"><![CDATA[<p>平时写业务一般是用不到反射的，但是框架内部会有非常多的反射，像Spring这一类。自己也去尝试实现过一个简单的框架，也有非常多的反射代码，反射跟普通的对象创建方法调用不同，在性能上不如前者，今天尝试着了解一下反射如何进行优化。<a id="more"></a>在我有限的认识里，主要两点:</p>
<ol>
<li>Class,Method,Field对象缓存。这一点好理解，这些对象的获取都是比较耗时的，不要每次使用都去获取一遍。</li>
<li>使用动态字节码技术，如cglib，它生成的代理类实际是被代理类的子类，在子类中调用父类的方法。<br>为了验证cglib能快多少我简单的写了个测试,环境是jdk8：</li>
</ol>
<figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> SampleBean &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">String</span> echo(<span class="keyword">String</span> name) &#123;</span><br><span class="line">        <span class="built_in">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">        测试代码：</span><br><span class="line">        FastClass fastClass = FastClass.create(SampleBean.<span class="keyword">class</span>);</span><br><span class="line">        FastMethod fastMethod = fastClass.getMethod(SampleBean.<span class="keyword">class</span>.getMethod(<span class="string">"echo"</span>, <span class="keyword">String</span>.<span class="keyword">class</span>));</span><br><span class="line">        SampleBean myBean = new SampleBean();</span><br><span class="line">        <span class="keyword">long</span> start = System.currentTimeMillis();</span><br><span class="line">        <span class="built_in">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">1000000</span>; i++) &#123;</span><br><span class="line">            fastMethod.invoke(myBean, new Object[]&#123;<span class="string">"haha"</span>+i&#125;);</span><br><span class="line">            <span class="comment">//fastMethod.invoke(myBean, new Object[]&#123;"haha"&#125;);</span></span><br><span class="line">        &#125;</span><br><span class="line">        System.out.<span class="built_in">println</span>(<span class="string">"fastmethod:"</span> + (System.currentTimeMillis() - start));</span><br><span class="line">        </span><br><span class="line">        start = System.currentTimeMillis();</span><br><span class="line">        Method m = SampleBean.<span class="keyword">class</span>.getMethod(<span class="string">"echo"</span>, <span class="keyword">String</span>.<span class="keyword">class</span>);</span><br><span class="line">        <span class="built_in">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">1000000</span>; i++) &#123;</span><br><span class="line">            m.invoke(myBean, <span class="string">"haha"</span>+i);</span><br><span class="line">            <span class="comment">//m.invoke(myBean, "haha");</span></span><br><span class="line">        &#125;</span><br><span class="line">        System.out.<span class="built_in">println</span>(<span class="string">"reflect:"</span>+(System.currentTimeMillis() - start));</span><br><span class="line">        </span><br><span class="line">        start = System.currentTimeMillis();</span><br><span class="line">        <span class="built_in">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">1000000</span>; i++) &#123;</span><br><span class="line">            myBean.echo(<span class="string">"haha"</span>+i);</span><br><span class="line">            <span class="comment">//myBean.echo("haha");</span></span><br><span class="line">        &#125;</span><br><span class="line">        System.out.<span class="built_in">println</span>(<span class="string">"normal:"</span>+(System.currentTimeMillis() - start));</span><br></pre></td></tr></table></figure>
<p>输出很有意思：fastmethod:196 &gt; reflect:139 &gt; normal:72,cglib是最慢的？！！！如果使用注释的代码跑，fastmethod:38 &gt; reflect:33 &gt; normal:25,时间省了很多但三者的大小顺序没变，时间变少我猜测是百万次调用的参数不变被优化了。<br>于是我怀疑我的测试代码是不是有问题，在网上看了一通发现Java的benchmark是不容易做的，要剔除无关的操作，还要做好JVM的JIT预热，而且有多种gc算法。所以上述所谓的性能测试就是扯淡，不靠谱的…<br>而对于我颇感意外的cglib不如Java自身反射api快的结论，在cglib的文档上也能看到一点端倪：</p>
<blockquote>
<p>However, the newer versions of the HotSpot JVM (and probably many other modern JVMs) know a concept called inflation where the JVM will translate reflective method calls into native version’s of FastClass when a reflective method is executed often enough.  I would therefore recommend to not use FastClass on modern JVMs, it can however fine-tune performance on older Java virtual machines.</p>
</blockquote>
<p>最后，关于Java的benchmark在<a href="http://stackoverflow.com/questions/504103/how-do-i-write-a-correct-micro-benchmark-in-java" target="_blank" rel="external">stackoverflow</a>上有一个讨论; 各个字节码框架与Java自身的反射的性能<a href="https://github.com/neoremind/dynamic-proxy" target="_blank" rel="external">对比</a>,可以参考。结论就是在高版本的Java中反射的性能其实已经挺不错了！</p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[jar包中内容的读取]]></title>
      <url>http://twogoods.github.io/2017/04/01/jar/</url>
      <content type="html"><![CDATA[<p>最近几天有空在折腾<a href="https://github.com/twogoods/tiny4j" target="_blank" rel="external">tiny4j</a>里一直想试着实现的类似springboot的可执行jar包。在<code>component-scan</code>包扫描这一步碰上点小问题，记录一下。<br>项目的<code>Bean</code>都是基于<code>component-scan</code>扫描得到的，要实现这个功能首先根据配置的包名查找的资源路径，这一点可以通过类加载器来得到,它可以在运行时动态的获取加载的类的信息<code>class.getClass().getResource(packageName);</code>这个函数返回一个迭代URL。<a id="more"></a><br>这时如果我们通过<code>java -jar XXX.jar</code>来运行，返回的URL会是类似这样的<code>/Users/xxx/IdeaProjects/web/target/web.jar!/classes/rest.jar/com/tg</code>。jar包是一个文件，文件内部的一些信息没办法直接通过文件API得到，我们可以通过<code>JarFile</code>来得到</p>
<figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">JarFile </span>localJarFile = new <span class="keyword">JarFile(new </span>File(<span class="string">"/Users/xxx/IdeaProjects/abc/web/target/web.jar"</span>))<span class="comment">;</span></span><br><span class="line">Enumeration&lt;<span class="keyword">JarEntry&gt; </span>entries = localJarFile.entries()<span class="comment">;</span></span><br><span class="line">        while (entries.hasMoreElements()) &#123;</span><br><span class="line">            <span class="keyword">JarEntry </span><span class="keyword">jarEntry </span>= entries.nextElement()<span class="comment">;</span></span><br><span class="line">            System.out.println(<span class="keyword">jarEntry.getName());</span><br><span class="line"></span>        &#125;</span><br></pre></td></tr></table></figure>
<p>如果我们要扫描的类在jar包里的jar包里该怎么办呢？如这个URL <code>/Users/xxx/IdeaProjects/web/target/web.jar!/BOOT-INF/lib/rest.jar/com/tg</code>,这个形式在可执行Jar里是很正常的，lib目录下是一些依赖的jar。然而上述方法已经得不到这个路径中<code>rest.jar</code>里的内容了。可能这个问题不是很常见，网上找了一圈也没找到解决方法，遂跑去看了一下Spring的实现。在Spring的<code>PathMatchingResourcePatternResolver</code>看到了关键的一个方法</p>
<figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">protected Set&lt;Resource&gt; doFindPathMatchingJarResources(Resource rootDirResource, String <span class="keyword">subPattern) </span>throws IOException &#123;</span><br><span class="line">       URLConnection con = rootDirResource.getURL().openConnection()<span class="comment">;</span></span><br><span class="line">       <span class="keyword">boolean </span>newJarFile = false<span class="comment">;</span></span><br><span class="line">       <span class="keyword">JarFile </span><span class="keyword">jarFile;</span><br><span class="line"></span>       String <span class="keyword">jarFileUrl;</span><br><span class="line"></span>       String rootEntryPath<span class="comment">;</span></span><br><span class="line">       if(con <span class="keyword">instanceof </span><span class="keyword">JarURLConnection) </span>&#123;</span><br><span class="line">           <span class="keyword">JarURLConnection </span>result = (<span class="keyword">JarURLConnection)con;</span><br><span class="line"></span>           ResourceUtils.useCachesIfNecessary(result)<span class="comment">;</span></span><br><span class="line">           <span class="keyword">jarFile </span>= result.getJarFile()<span class="comment">;</span></span><br><span class="line">           <span class="keyword">jarFileUrl </span>= result.getJarFileURL().toExternalForm()<span class="comment">;</span></span><br><span class="line">           <span class="keyword">JarEntry </span>entries = result.getJarEntry()<span class="comment">;</span></span><br><span class="line">           rootEntryPath = entries != null?entries.getName():<span class="string">""</span><span class="comment">;</span></span><br><span class="line">       &#125; else &#123;</span><br><span class="line">           String result1 = rootDirResource.getURL().getFile()<span class="comment">;</span></span><br><span class="line">           int entries1 = result1.indexOf(<span class="string">"!/"</span>)<span class="comment">;</span></span><br><span class="line">           if(entries1 != -<span class="number">1</span>) &#123;</span><br><span class="line">               <span class="keyword">jarFileUrl </span>= result1.<span class="keyword">substring(0, </span>entries1)<span class="comment">;</span></span><br><span class="line">               rootEntryPath = result1.<span class="keyword">substring(entries1 </span>+ <span class="string">"!/"</span>.length())<span class="comment">;</span></span><br><span class="line">               <span class="keyword">jarFile </span>= this.getJarFile(<span class="keyword">jarFileUrl);</span><br><span class="line"></span>           &#125; else &#123;</span><br><span class="line">               <span class="keyword">jarFile </span>= new <span class="keyword">JarFile(result1);</span><br><span class="line"></span>               <span class="keyword">jarFileUrl </span>= result1<span class="comment">;</span></span><br><span class="line">               rootEntryPath = <span class="string">""</span><span class="comment">;</span></span><br><span class="line">           &#125;</span><br><span class="line">           newJarFile = true<span class="comment">;</span></span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       LinkedHashSet entries3<span class="comment">;</span></span><br><span class="line">       try &#123;</span><br><span class="line">           if(logger.isDebugEnabled()) &#123;</span><br><span class="line">               logger.debug(<span class="string">"Looking for matching resources in jar file ["</span> + <span class="keyword">jarFileUrl </span>+ <span class="string">"]"</span>)<span class="comment">;</span></span><br><span class="line">           &#125;</span><br><span class="line">           if(!<span class="string">""</span>.equals(rootEntryPath) &amp;&amp; !rootEntryPath.endsWith(<span class="string">"/"</span>)) &#123;</span><br><span class="line">               rootEntryPath = rootEntryPath + <span class="string">"/"</span><span class="comment">;</span></span><br><span class="line">           &#125;</span><br><span class="line">           LinkedHashSet result2 = new LinkedHashSet(<span class="number">8</span>)<span class="comment">;</span></span><br><span class="line">           Enumeration entries2 = <span class="keyword">jarFile.entries();</span><br><span class="line"></span>           while(entries2.hasMoreElements()) &#123;</span><br><span class="line">               <span class="keyword">JarEntry </span>entry = (<span class="keyword">JarEntry)entries2.nextElement();</span><br><span class="line"></span>               String entryPath = entry.getName()<span class="comment">;</span></span><br><span class="line">               if(entryPath.startsWith(rootEntryPath)) &#123;</span><br><span class="line">                   String relativePath = entryPath.<span class="keyword">substring(rootEntryPath.length());</span><br><span class="line"></span>                   if(this.getPathMatcher().match(<span class="keyword">subPattern, </span>relativePath)) &#123;</span><br><span class="line">                       result2.<span class="keyword">add(rootDirResource.createRelative(relativePath));</span><br><span class="line"></span>                   &#125;</span><br><span class="line">               &#125;</span><br><span class="line">           &#125;</span><br><span class="line">           entries3 = result2<span class="comment">;</span></span><br><span class="line">       &#125; finally &#123;</span><br><span class="line">           if(newJarFile) &#123;</span><br><span class="line">               <span class="keyword">jarFile.close();</span><br><span class="line"></span>           &#125;</span><br><span class="line"></span><br><span class="line">       &#125;</span><br><span class="line">       return entries3<span class="comment">;</span></span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<p>方法里的一些对jar的操作其实跟最上的那段代码差不多，在简单调试后我发现Spring的这段代码也是无法实现读取第二层jar包的。这是Spring里的实现，并非SpringBoot<code>@ComponentScan</code>注解的实现，我们传统的Spring项目还是通过war包的方式部署，虽然war包里也有lib目录，看似确实是有两层jar，但在把war部署到servlet容器的时候，其实容器帮我们做了一次解压操作，于是这个场景下就只有一层jar了，或许这就能解释为什么spring上述实现依旧可以正常运行。<br>当然，最终我还是在网上找到了读取多层jar的方法:</p>
<figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">URL url = new URL(<span class="string">"jar"</span>, null, <span class="number">0</span>, <span class="string">"file:/Users/xxx/IdeaProjects/web/target/web.jar!/BOOT-INF/lib/rest.jar"</span>)<span class="comment">;</span></span><br><span class="line">        URLConnection con = url.openConnection()<span class="comment">;</span></span><br><span class="line">        if (con <span class="keyword">instanceof </span><span class="keyword">JarURLConnection) </span>&#123;</span><br><span class="line">            <span class="keyword">JarURLConnection </span>result = (<span class="keyword">JarURLConnection) </span>con<span class="comment">;</span></span><br><span class="line">            <span class="keyword">JarInputStream </span><span class="keyword">jarInputStream </span>= new <span class="keyword">JarInputStream(result.getInputStream());</span><br><span class="line"></span>            <span class="keyword">JarEntry </span>entry<span class="comment">;</span></span><br><span class="line">            while ((entry = <span class="keyword">jarInputStream.getNextJarEntry()) </span>!= null) &#123;</span><br><span class="line">                System.out.println(entry.getName())<span class="comment">;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[docker]]></title>
      <url>http://twogoods.github.io/2017/02/25/docker/</url>
      <content type="html"><![CDATA[<p>折腾下docker，由于是Mac，安装非常得简单，下载dmg直接安装就行。docker一些基本的概念image，container也都好理解，跑一下nginx，熟悉一下命令行，也算是完成了helloworld了。镜像pull很慢，可以使用<a href="https://www.daocloud.io/" target="_blank" rel="external">daocloud</a>的镜像。<a id="more"></a>  </p>
<p>接下来看看自己写的Java程序怎么build一个镜像.SpringBoot其实官方就有<a href="http://spring.io/guides/gs/spring-boot-docker/" target="_blank" rel="external">文档</a>，也非常的简单，用的maven插件spotify。自己在打包的时候报了个500错误，还找了好一会儿，结果发现自己二了，<code>dockerfile</code>写成了<code>dockfile</code>，丢人了(捂脸)…找错误的时候也发现maven里<code>imageName</code>不要出现大写否则会出错。一条基本的启动命令:<br><code>docker run -e &quot;SPRING_PROFILES_ACTIVE=dev&quot; -p 9002:9001 --name book-dev -t bookplatform</code><br><code>docker logs {containername}</code>可以查看日志，不过感觉这种方式不好，当然也可以把日志挂载到本地的目录方便查看，当然这一块的最佳实践还是去看看人家生产环境的经验分享比较好。既然是虚拟机当然也可以进入终端了<code>docker exec -i -t {containername} /bin/sh</code>  </p>
<p>以上都挺简单的，<code>dockerfile</code>要多写写，docker算是开了个头。</p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[HelloRPC]]></title>
      <url>http://twogoods.github.io/2017/02/22/hellorpc/</url>
      <content type="html"><![CDATA[<p>在学校里总要拿点什么东西练练手，看了些文章像什么《从零开始写Rpc》，《从零开始写搜索引擎》都是可以一试的。其实前些日子的<a href="https://github.com/twogoods/tiny4j" target="_blank" rel="external">tiny4j</a>还有些要改进继续完善的东西，奈何人都是喜新厌旧的，总忍不住再开一坑，所以这次是RPC。<a id="more"></a>  </p>
<p>在开始写之前做了不少准备，了解RPC的一些基本的东西，也找了一些RPC框架在试用，诸如GRPC，thrift，它们都提供跨语言调用的能力，根据写的一些配置便可自动生成一些代码。除了这两个国产框架里也有非常优秀的如阿里开源的dubbo，微博的motan；微博的motan文档很简洁，而且直接支持Springboot的注解形式。马上尝试了一下helloworld，大呼过瘾！不考虑跨语言，对于特定的Java，它的Api设计其简单方便，几个注解搞定所有服务，对于Java，这就是我想要的RPC！代码clone下来一看，传输层用的是netty，为了能够完成这个又跑去搞了本《netty 权威指南》啃了大半本，算是入了个门。  </p>
<p>准备工作差不多了于是开始尝试写，毕竟是第一次写，就不考虑跨语言了，像motan一样配合Spring使用能顺手简单就行。简单梳理的整个RPC调用过程，可以分成以下几层：<br><img src="http://i1.piimg.com/4851/71a40fa8d3564fbf.png" alt="rpc层次"><br>通信包括连接建立、消息传输， 编解码要传输的内容，序列化和反序列化，最后是客户端和服务端的实现，客户调用一个服务的代理实现，发起对服务端的请求。  </p>
<p>基于netty5.0，protostuff、kryo序列化库，commons-pool2实现连接池，服务代理使用jdk自身的Proxy或Cglib，在这样一堆优秀的框架和类库上，整个RPC的构建就简单了不少。</p>
<h3 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h3><p>贴一段与Springboot整合的代码，完整的在<a href="https://github.com/twogoods/HelloRpc" target="_blank" rel="external">这里</a>。<br>使用<code>@RpcService</code>注解服务</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">EchoService</span> </span>&#123;</span><br><span class="line">    <span class="function">String <span class="title">echo</span><span class="params">(String s)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RpcService</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EchoServiceImpl</span> <span class="keyword">implements</span> <span class="title">EchoService</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">echo</span><span class="params">(String s)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> s;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>application.yml</code>配置</p>
<figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">tgrpc:</span></span><br><span class="line"><span class="symbol">    host:</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span></span><br><span class="line"><span class="symbol">    port:</span> <span class="number">9100</span></span><br><span class="line"><span class="symbol">    maxCapacity:</span> <span class="number">3</span></span><br><span class="line"><span class="symbol">    requestTimeoutMillis:</span> <span class="number">8000</span></span><br><span class="line"><span class="symbol">    maxTotal:</span> <span class="number">3</span></span><br><span class="line"><span class="symbol">    maxIdle:</span> <span class="number">3</span></span><br><span class="line"><span class="symbol">    minIdle:</span> <span class="number">0</span></span><br><span class="line"><span class="symbol">    borrowMaxWaitMillis:</span> <span class="number">5000</span></span><br></pre></td></tr></table></figure>
<p>启动server:</p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">@SpringBootApplication</span></span><br><span class="line"><span class="variable">@EnableAutoConfiguration</span></span><br><span class="line"><span class="variable">@EnableRpcServer</span> <span class="comment">//启用Server</span></span><br><span class="line"><span class="variable">@ComponentScan</span>()</span><br><span class="line">public class ServerApplication &#123;</span><br><span class="line">    <span class="selector-tag">public</span> <span class="selector-tag">static</span> <span class="selector-tag">void</span> <span class="selector-tag">main</span>(String[] args) &#123;</span><br><span class="line">        ApplicationContext applicationContext = SpringApplication<span class="selector-class">.run</span>(ServerApplication.class);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>调用方使用<code>@RpcReferer</code>注解.</p>
<figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ServiceCall</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RpcReferer</span></span><br><span class="line">    <span class="keyword">private</span> EchoService echoService;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function">String <span class="title">echo</span><span class="params">(String s)</span> </span>&#123;</span><br><span class="line">        <span class="function"><span class="keyword">return</span> echoService.<span class="title">echo</span><span class="params">(s)</span></span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>启动Client发起调用</p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">@SpringBootApplication</span></span><br><span class="line"><span class="variable">@EnableAutoConfiguration</span></span><br><span class="line"><span class="variable">@EnableRpcClient</span> <span class="comment">//启用Client</span></span><br><span class="line"><span class="variable">@ComponentScan</span>(basePackages = &#123;<span class="string">"com.tg.rpc.springsupport.bean.client"</span>&#125;)</span><br><span class="line">public class ClientApplication &#123;</span><br><span class="line">    <span class="selector-tag">public</span> <span class="selector-tag">static</span> <span class="selector-tag">void</span> <span class="selector-tag">main</span>(String[] args) &#123;</span><br><span class="line">        ApplicationContext applicationContext = SpringApplication<span class="selector-class">.run</span>(ClientApplication.class);</span><br><span class="line">        ServiceCall serviceCall = (ServiceCall) applicationContext<span class="selector-class">.getBean</span>(<span class="string">"serviceCall"</span>);</span><br><span class="line">        System<span class="selector-class">.out</span><span class="selector-class">.println</span>(<span class="string">"echo return :"</span> + serviceCall.echo(<span class="string">"TgRPC"</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>整个的使用非常简单，当然这中间SpringBoot也占了很大的功劳。</p>
<h3 id="TODO"><a href="#TODO" class="headerlink" title="TODO"></a>TODO</h3><p>当然这还没完，还有很多工作需要做：</p>
<ul>
<li>性能优化</li>
<li>服务注册中心</li>
</ul>
<p>毕竟是一个简单的实现，性能优化方面肯定会去做，但这块又要设计很多的内容：对netty深入的理解，做性能测试找到瓶颈再改进，这些对我来说都是第一次需要慢慢来。<br>注册中心这个最近已经在做一些工作了，现在考虑会把consul,zookeeper都实现一遍，zookeeper以前就玩过，consul现在已经上手了，基本的服务注册，健康检查的概念及使用都以清晰，接下来会开始实现。</p>
<p>未完，待续，争取全部搞定来个总结。</p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[tiny4j:一个轻量级的类似Spring的实现]]></title>
      <url>http://twogoods.github.io/2016/12/04/tiny4j/</url>
      <content type="html"><![CDATA[<p>会点java，做点web，基本也就是spring全家桶，所以打算自己折腾一个，实现最基本最常用的一些功能。断断续续地终于完成了大部分自己想要的功能。实际项目中使用或许还不太现实，不过也提供了一个去了解框架实现的一个简单的版本，也让大家有动力有思路自己去实现一个，源码请戳<a href="https://github.com/twogoods/tiny4j" target="_blank" rel="external">github</a>。<a id="more"></a></p>
<h3 id="IOC"><a href="#IOC" class="headerlink" title="IOC"></a>IOC</h3><p>IOC很大程度借鉴了Spring,简单的使用</p>
<figure class="highlight ceylon"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">ApplicationContext applicationContext = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">"test.xml"</span>);</span><br><span class="line">ServiceBean serviceBean=(ServiceBean)applicationContext.getBean(<span class="string">"testService"</span>);</span><br><span class="line">System.<span class="keyword">out</span>.println(serviceBean);</span><br><span class="line">serviceBean.service();</span><br><span class="line"></span><br><span class="line">ServiceBean serviceBean<span class="number">2</span>=(ServiceBean)applicationContext.getBean(<span class="string">"serviceBean"</span>);</span><br><span class="line">System.<span class="keyword">out</span>.println(serviceBean<span class="number">2</span>);</span><br><span class="line">serviceBean<span class="number">2</span>.service();</span><br><span class="line"></span><br><span class="line"><span class="comment">//全局的容器上下文</span></span><br><span class="line">ApplicationContextHolder holder=applicationContext.getBean(<span class="string">"applicationContextHolder"</span>, ApplicationContextHolder.<span class="keyword">class</span>);</span><br><span class="line">System.<span class="keyword">out</span>.println(<span class="string">"holder get bean : "</span>+holder.getBean(<span class="string">"serviceBean"</span>));</span><br></pre></td></tr></table></figure>
<p><a href="https://github.com/twogoods/tiny4j/tree/master/core" target="_blank" rel="external">IOC详细说明</a></p>
<h3 id="rest"><a href="#rest" class="headerlink" title="rest"></a>rest</h3><p>实现了许多SpringMvc里高频使用的功能和一些针对restful改进的功能</p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">@Api</span>(<span class="string">"/base"</span>)</span><br><span class="line">public class TestController extends BaseController &#123;</span><br><span class="line"></span><br><span class="line">    <span class="variable">@Value</span>(<span class="string">"$&#123;user.name:test&#125;"</span>)</span><br><span class="line">    private String name;</span><br><span class="line"></span><br><span class="line">    <span class="variable">@Inject</span></span><br><span class="line">    private UserService userService;</span><br><span class="line"></span><br><span class="line">    <span class="variable">@RequestMapping</span></span><br><span class="line">    public String index() &#123;</span><br><span class="line">        userService<span class="selector-class">.query</span>();</span><br><span class="line">        return name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="variable">@RequestMapping</span>(mapUrl = <span class="string">"/test/&#123;id&#125;"</span>, method = HttpMethod.GET)</span><br><span class="line">    <span class="variable">@CROS</span>(origins = <span class="string">"www.baidu.com"</span>, methods = &#123;HttpMethod.GET&#125;, maxAge = <span class="string">"3600"</span>)</span><br><span class="line">    public String patgTest(<span class="variable">@PathVariable</span>(<span class="string">"id"</span>) String id) &#123;</span><br><span class="line">        return id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="variable">@RequestMapping</span>(mapUrl = <span class="string">"/test"</span>, method = HttpMethod.GET)</span><br><span class="line">    <span class="variable">@InterceptorSelect</span>(include = &#123;<span class="string">"aInterceptor"</span>&#125;, exclude = &#123;<span class="string">"bInterceptor"</span>&#125;)</span><br><span class="line">    public String interceptorTest() &#123;</span><br><span class="line">        return "haha";</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="variable">@RequestMapping</span>(mapUrl = <span class="string">"/index"</span>)</span><br><span class="line">    <span class="variable">@CROS</span></span><br><span class="line">    public String paramTest(<span class="variable">@RequestParam</span>(<span class="string">"id"</span>) long id, <span class="variable">@RequestParam</span>(<span class="string">"name"</span>) String name) &#123;</span><br><span class="line">        return name + "---" + id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="variable">@RequestMapping</span>(mapUrl = <span class="string">"/user/&#123;id&#125;"</span>, method = HttpMethod.PUT)</span><br><span class="line">    <span class="variable">@CROS</span></span><br><span class="line">    public User insert(<span class="variable">@PathVariable</span>(<span class="string">"id"</span>) long id, <span class="variable">@RequestBody</span> User user) &#123;</span><br><span class="line">        return user;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>看着是不是很熟悉-_- <a href="https://github.com/twogoods/tiny4j/tree/master/rest" target="_blank" rel="external">rest详细说明</a></p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[关于动态代理]]></title>
      <url>http://twogoods.github.io/2016/11/02/proxy/</url>
      <content type="html"><![CDATA[<p>一般的程序不太会用到动态代理，在写库或者框架的时候用的多一些，我呢硬着头皮在试着完成一个类似spring的框架，过程中自然碰到了动态代理的一些小问题。  <a id="more"></a></p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">@Configuration</span></span><br><span class="line">public class WebAppConfig extends WebMvcConfigurerAdapter &#123;</span><br><span class="line">    <span class="variable">@Value</span>(<span class="string">"$&#123;name&#125;"</span>)</span><br><span class="line">    private String name;</span><br><span class="line">    </span><br><span class="line">    <span class="variable">@Bean</span></span><br><span class="line">    AuthorizeInterceptor authorizelInterceptor() &#123;</span><br><span class="line">        return new AuthorizeInterceptor(name);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="variable">@Override</span></span><br><span class="line">    public void addInterceptors(InterceptorRegistry registry) &#123;</span><br><span class="line">        registry<span class="selector-class">.addInterceptor</span>(authorizelInterceptor())</span><br><span class="line">                <span class="selector-class">.addPathPatterns</span>(<span class="string">"/user/**"</span>);</span><br><span class="line">        super<span class="selector-class">.addInterceptors</span>(registry);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我是这么理解这段代码的：@Bean注解的方法里new出来的对象会仍到IOC里，下面调用了上面注解的方法会在IOC里拿出这个Bean。想改变方法的执行，首先想到的是动态代理。  </p>
<ul>
<li>JDK的动态代理，文中例子里下面这个方法addInterceptors()调用authorizelInterceptor()方法，在执行authorizelInterceptor()这个方法的时候是原模原样执行的不会再走一次代理。</li>
<li>Cglib，方法之间调用都会走代理，适合这个例子。</li>
</ul>
<p>解析<code>@Bean</code>最先想到的方法是这样：创建普通Bean一样创建实例，然后调用所有的<code>@Bean</code>注解的方法，方法得到的Bean放入IOC，最后创建一个这个类的代理对象放入IOC，也就是定义的这个Bean的实例在IOC里实际是一个代理对象。(这个方法有问题，像上面这个例子，<code>addInterceptors()</code>会调用<code>authorizelInterceptor()</code>普通对象调用的时候会创建一个<code>AuthorizeInterceptor</code>,<code>authorizelInterceptor()</code>调用的时候又会创建一个)。为解决这个问题，我们可以一开始就创建代理对象，代理对象调用方法的时候，先查看IOC里有没有这个Bean，没有就创建，有就直接返回IOC里的实例，这样就确保一个Bean只产生了一个实例。<br>我们一开始就创建一个这个类的代理对象，又发现这个类注入了一个属性值，方法里也会使用这个属性，而我在查看创建的代理对象的field时发现并没有<code>name</code>这个field，所以没办法直接设置这个值，这时只能调用<code>setter</code>即<code>setName()</code>来赋上值。然而如果我类里没有创建<code>setter</code>那就无法赋值，好在Cglib可以动态的为属性加上<code>setter</code>方法来解决这个问题。<br>最后，以上是我拿到这个问题自己的一些思考，还并没有看过Spring的实现，有时间去了解一下补上spring的实现。</p>
<hr>
<p><a href="https://github.com/twogoods/tiny4j/blob/master/core/src/test/java/com/tg/tiny4j/core/aop/CglibDynamicAopProxyTest.java" target="_blank" rel="external">代码参考</a></p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[golang小玩具]]></title>
      <url>http://twogoods.github.io/2016/10/09/gotoys/</url>
      <content type="html"><![CDATA[<p>趁着十一假期的最后几天，写了个一直以来就想尝试的东西：命令行程序。还记得当初第一个让我非常惊艳的命令行程序<a href="https://github.com/darknessomi/musicbox" target="_blank" rel="external">网易云音乐命令行版</a>，支持快捷键，带歌词简直6的不行。毕竟程序员，平时离不开terminal，加上iTerm和Oh-My-Zsh更是让人爱不释手。<a id="more"></a>  </p>
<p>所以趁着这几天写了个简单的小玩具，会一些go所以继续用go写，实现了快递查询，天气查询的功能。天气已经实现了根据ip自动定位;快递由于要选择公司，希望接下来可以尝试利用按键来选择。</p>
<h3 id="快递查询"><a href="#快递查询" class="headerlink" title="快递查询"></a>快递查询</h3><p><img src="https://raw.githubusercontent.com/twogoods/tgToys/master/express/express.png" alt="快递查询"></p>
<h3 id="天气查询"><a href="#天气查询" class="headerlink" title="天气查询"></a>天气查询</h3><p><img src="https://raw.githubusercontent.com/twogoods/tgToys/master/weather/weather.png" alt="天气查询"><br><a href="https://github.com/twogoods/tgToys" target="_blank" rel="external">项目地址</a></p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[最好的你们]]></title>
      <url>http://twogoods.github.io/2016/06/26/graduate/</url>
      <content type="html"><![CDATA[<p>最好的四年，遇到最好的你们。  </p>
<p>时间很快，列车也到终点站了，老司机们再不舍也得下车了~一个人闭眼冥想以前的一幕幕都很清晰的浮现在眼前，遇到一些有意思的事还能傻傻的笑，遗憾也就不遗憾了。<a id="more"></a></p>
<h3 id="618"><a href="#618" class="headerlink" title="618"></a>618</h3><p><img src="http://oepm97cib.bkt.clouddn.com/DSCN0516.JPG" alt=""></p>
<p>咱在那里算第一次相遇，某人以一个妖娆的姿势躺在床上欢迎我（我当时的第一感受，这货是哪来的→_→简直辣眼睛)。在618的日子里咱没少浪，每到周五临近周末你们又开始解放天性了不是~当然你们当中的几个懒癌患者的生活习惯哥哥实在是看不下去，到了大二分寝室，我也只能眼睁睁的看着你们生活在水深火热之中。好在分了寝室也没影响咱的交情，该扯淡扯淡，该聊段子还得接着聊，该涮的还是拿某人开涮，只是某人再也不要喝二锅头罢了…但愿你们都不带遗憾的离开。</p>
<h3 id="1203"><a href="#1203" class="headerlink" title="1203"></a>1203</h3><p><img src="http://oepm97cib.bkt.clouddn.com/DSC_6328.jpg" alt=""></p>
<p>咱们班有五个大美女，剩下的都得管着叫爷，光好帅就俩，牛逼的班级你不服不行啊~近30个人，自然无法面面俱到，但遇到过就很好。毕业典礼那天，我把自己人生的第一次通宵奉献给了你们，我第一次看到了班级女生多愁善感的时候，姑娘间那种感情，那种舍不得看得我也有说不出的味道。今天你们中的大部分人都离开学校了，能说再见的我一定不保留，我会再呆几天，争取把你们都送走了我再走。聚是一盆火，散做满天星，天涯海角各奔东西。或许以后你们就是我只能在朋友圈里见到的面孔了，我祝福大家，同样请大家祝福我。</p>
<p><img src="http://ww3.sinaimg.cn/mw690/af5c6f4agw1f58x0skj2jj21kw12a1kx.jpg" alt=""></p>
<h3 id="51"><a href="#51" class="headerlink" title="51"></a>51</h3><p>近一年来的故事似乎都在这里了，在这里有我从来没见到过的风景，当然还有那群可爱的你们。陆陆续续的来，陆陆续续的走，这就是真实的职场节奏。我一直管自己叫傻逼程序员，然而有人说，你不像普通敲代码的，你很有趣，但愿如此吧。渐渐的你们朋友圈下的评论少了我的踪影，但一个赞就代表了全部。我和你们一样，经历了一年的实习生活，眼瞅着你们修成正果毕业工作，我却迎来了一个假期，心里有点空落落的。不眼红，沉住气，我会回来。</p>
<h3 id="zjut"><a href="#zjut" class="headerlink" title="zjut"></a>zjut</h3><p>上了大学就知道其实没那么多好与坏，四年前如果没有选择工大，或许只是故事中的人变了而已，我依旧会变得像现在的我，依旧对一切都表示不服气。大四一年很少逛工大，临走前也应该再去看看它。北上深杭，四座互联网大城市，我的下一站是魔都，我挺恋旧的，上海离杭州不远，我会常回来，看看生活了四年的地方，这一定不是我与工大的最后一张合影。  </p>
<p><img src="http://oepm97cib.bkt.clouddn.com/P60621-170036.jpg" alt=""></p>
<h3 id="me"><a href="#me" class="headerlink" title="me"></a>me</h3><p>最终还是选择了升学，想去见识见识真正的高山。coder,engineer or scientist? no!no!no! 指不定哪天我摇身一变，额，还是一屌丝…哈哈~~ 我在上海，等大家来！</p>
<p>感谢你们，也感谢那些我从未提起的鲜为人知却又妙不可言的故事，你们就是这四年里来我最棒的体验。<br>下次再见请给我一个大大的拥抱！</p>
<blockquote>
<p>一支穿云箭，千军万马来相见<br>两副忠义胆，刀山火海提命现</p>
</blockquote>
<p>圈子不大，方寸之间，我依旧是傻逼程序员，独爱我的mac和code~</p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[博客的私密空间]]></title>
      <url>http://twogoods.github.io/2016/06/15/privateblog/</url>
      <content type="html"><![CDATA[<p>很早就有了搞个博客私密空间的想法，需求来源于自己会写一些个人的感受，总结之类的东西，而这些东西我又不太希望每个人都能看到。我知道你要说，你不想让别人看到干脆就不要放博客里嘛！然而你不懂傻逼程序员在写完一篇博客之后不能放在网上嘚瑟的那种不爽的感觉。so，装X绝对是第一生产力，哈哈~  </p>
<p>一直在实习也就一直没找到时间搞这个，当然最重要的一个原因是，现在这个博客是一个利用hexo生成的静态博客，不太好改造。最终为了风格的统一，页面继续用hexo，配合着用go写了个简单的web server，趁着毕业答辩这段时间折腾了一两天，基本实现了自己想要的功能，页面的导航栏处你就能看到它。</p>
<p>微信是试水很多东西最好的地方，然而个人公众号无法申请认证…→ →我选择狗带。<br>马上就毕业了，good luck~</p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[profile及配置服务]]></title>
      <url>http://twogoods.github.io/2016/04/05/profile/</url>
      <content type="html"><![CDATA[<p>一套完整的代码肯定有不同的profile，开发环境，测试环境，线上环境；程序需要读取不同的配置文件来完成不同环境的部署。传统的spring项目需要使用<code>PropertyPlaceholderConfigurer</code>来完成不同环境下的读取；springboot则特别方便，对于application.yml,application-test.yml,application-dev.yml,在启动参数里加<code>-Dspring.profiles.active=test</code>就可以按需读取，这也还是从本地的不同文件中读取，spring-cloud也提供了一个cloud-config服务，可以非常简单的实现从云端读取不同的配置文件。</p>
<h3 id="基于XML配置的spring项目"><a href="#基于XML配置的spring项目" class="headerlink" title="基于XML配置的spring项目"></a>基于XML配置的spring项目</h3><p>传统的spring项目application.xml里关于配置文件的配置，这个<code>CloudConfigLoader</code>继承<code>PropertyPlaceholderConfigurer</code>来实现按需读取<a id="more"></a><br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"commonConfigurer"</span> <span class="attr">class</span>=<span class="string">"com.tg.common.configuration.CloudConfigLoader"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"locations"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">list</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">value</span>&gt;</span>classpath*:testsettings.properties<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">value</span>&gt;</span>classpath*:basesetting.properties<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">list</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"settingkeys"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">value</span>&gt;</span>managersetting,basesetting<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>看一下CloudConfigLoader类<br><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">CloudConfigLoader</span> <span class="keyword">extends</span> <span class="title">RemoteConfigLoader</span> </span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="type">InputStream</span> getConfigByKey(<span class="type">String</span> key) <span class="keyword">throws</span> <span class="type">Exception</span> &#123;</span><br><span class="line">        <span class="type">String</span> baseurl = <span class="type">System</span>.getProperty(<span class="string">"configurl"</span>);</span><br><span class="line">        <span class="comment">//profile:production/developer</span></span><br><span class="line">        <span class="comment">//启动加jvm参数：-Dconfigurl=xxx</span></span><br><span class="line">        <span class="comment">//-Dprofile=test(或product)</span></span><br><span class="line">        <span class="type">String</span> profile = <span class="type">System</span>.getProperty(<span class="string">"profile"</span>, <span class="string">"product"</span>);</span><br><span class="line">        <span class="type">String</span> requrl = baseurl;</span><br><span class="line">        <span class="keyword">if</span>(!baseurl.endsWith(<span class="string">"/"</span>))requrl+=<span class="string">"/"</span>;</span><br><span class="line">        requrl = requrl + key + <span class="string">"-"</span> + profile+<span class="string">".properties"</span>;</span><br><span class="line">        logger.info(<span class="string">"远程读取配置文件url："</span> + requrl);</span><br><span class="line">        <span class="type">String</span> result = callUrl(requrl,<span class="literal">null</span>,<span class="string">"GET"</span>,<span class="string">""</span>);</span><br><span class="line">        <span class="type">InputStream</span> in = <span class="keyword">new</span> <span class="type">ByteArrayInputStream</span>(result.getBytes());</span><br><span class="line">        <span class="keyword">return</span> in;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>以及RemoteConfigLoader<br><figure class="highlight processing"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> class RemoteConfigLoader extends PropertyPlaceholderConfigurer&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">String</span> settingkeys;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">protected</span> InputStream getConfigByKey(<span class="keyword">String</span> <span class="built_in">key</span>) <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">		<span class="keyword">String</span> baseurl = System.getProperty(<span class="string">"configurl"</span>);</span><br><span class="line">		<span class="keyword">String</span> requrl = baseurl + <span class="string">"?key="</span> + <span class="built_in">key</span>;</span><br><span class="line">		logger.info(<span class="string">"远程读取配置文件url："</span> + requrl);</span><br><span class="line">		<span class="keyword">String</span> json = callUrl(requrl,<span class="keyword">null</span>,<span class="string">"GET"</span>,<span class="string">""</span>);</span><br><span class="line">		InputStream in = <span class="keyword">new</span> ByteArrayInputStream(json.getBytes());</span><br><span class="line">		<span class="keyword">return</span> in;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">protected</span> <span class="keyword">String</span> callUrl(<span class="keyword">String</span> url, Map&lt;<span class="keyword">String</span>, <span class="keyword">String</span>&gt; <span class="built_in">map</span>,</span><br><span class="line">			<span class="keyword">String</span> method, <span class="keyword">String</span> cookie) &#123;</span><br><span class="line">		<span class="comment">//http请求读取云端文件</span></span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line"></span><br><span class="line">	<span class="keyword">protected</span> <span class="keyword">void</span> loadProperties(Properties props) <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">		<span class="keyword">super</span>.loadProperties(props);</span><br><span class="line">		<span class="keyword">String</span> configurl = System.getProperty(<span class="string">"configurl"</span>);</span><br><span class="line">		<span class="keyword">if</span> (settingkeys != <span class="keyword">null</span> &amp;&amp; configurl != <span class="keyword">null</span>)&#123;</span><br><span class="line">			<span class="keyword">String</span> [] keyarr = settingkeys.<span class="built_in">split</span>(<span class="string">","</span>);</span><br><span class="line">			<span class="keyword">for</span> (<span class="keyword">String</span> <span class="built_in">key</span> : keyarr)&#123;</span><br><span class="line">				InputStream in = <span class="keyword">null</span>;</span><br><span class="line">				<span class="keyword">try</span> &#123;</span><br><span class="line">					in = getConfigByKey(<span class="built_in">key</span>);</span><br><span class="line">					props.load(in);</span><br><span class="line">				&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">					logger.error(<span class="string">""</span>,e);</span><br><span class="line">				&#125;<span class="keyword">finally</span>&#123;</span><br><span class="line">					IOUtils.closeQuietly(in);</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>相应的从本地读不同的配置文件,修改getConfigByKey方法<br><figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> InputStream getConfigByKey(<span class="built_in">String</span> key) throws Exception &#123;</span><br><span class="line">       <span class="comment">//profile:test/product</span></span><br><span class="line">       <span class="built_in">String</span> profile = System.getProperty(<span class="string">"profile"</span>, <span class="string">"product"</span>);</span><br><span class="line">       <span class="built_in">String</span> configFile = key + <span class="string">"-"</span> + profile+<span class="string">".properties"</span>;</span><br><span class="line">       logger.info(<span class="string">"读取配置文件："</span> + configFile <span class="string">",</span><br><span class="line">               当前环境为："</span>+(<span class="string">"test"</span>.<span class="keyword">equals</span>(profile)?<span class="string">"测试"</span>:<span class="string">"生产"</span>));</span><br><span class="line">       InputStream <span class="keyword">in</span> = <span class="keyword">Thread</span>.currentThread().getContextClassLoader().</span><br><span class="line">               getResourceAsStream(configFile);</span><br><span class="line">       <span class="keyword">return</span> <span class="keyword">in</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="springboot"><a href="#springboot" class="headerlink" title="springboot"></a>springboot</h3><p>springboot中application.yml里配置不同的profiles,如下分development，production<br><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line"><span class="attr">    profiles:</span> development</span><br><span class="line"><span class="attr">server:</span></span><br><span class="line"><span class="attr">  port:</span> <span class="number">10000</span></span><br><span class="line"><span class="attr">  contextPath:</span> /demo</span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line"><span class="attr">    profiles:</span> production</span><br><span class="line"></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line"><span class="attr">  port:</span> <span class="number">8080</span></span><br><span class="line"><span class="attr">  contextPath:</span> /demo</span><br></pre></td></tr></table></figure></p>
<p>或者分别配置在不同的文件中，application.yml,application-dev.yml,application-test.yml,默认使用application.yml<br>打成jar包后使用命令<code>java -jar -Dspring.profiles.active=dev 51banka.jar</code></p>
<h3 id="Spring-Cloud-Config"><a href="#Spring-Cloud-Config" class="headerlink" title="Spring Cloud Config"></a>Spring Cloud Config</h3><p>Spring Cloud Config 被设计的非常简单，几乎不需要写代码，看官方文档就可以，添加一些spring cloud的pom依赖，这个就不列出来了。<br><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">@SpringBootApplication</span></span><br><span class="line"><span class="variable">@EnableConfigServer</span></span><br><span class="line"><span class="comment">//EnableConfigServer注解一定要加</span></span><br><span class="line">public class ConfigServiceApplication &#123;</span><br><span class="line">    <span class="selector-tag">public</span> <span class="selector-tag">static</span> <span class="selector-tag">void</span> <span class="selector-tag">main</span>(String[] args) &#123;</span><br><span class="line">        SpringApplication<span class="selector-class">.run</span>(ConfigServiceApplication.class,args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>resource下有application.yml,bootstrap.yml;这两个的区别是bootstrap.yml里是相对不变的配置，application.yml里是可以根据cloud服务动态变的。bootstrap.yml:<br><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">spring:</span></span><br><span class="line"><span class="symbol">  application:</span></span><br><span class="line"><span class="symbol">    name:</span> configService</span><br><span class="line"><span class="symbol">server:</span></span><br><span class="line"><span class="symbol">  port:</span> <span class="number">9999</span></span><br></pre></td></tr></table></figure></p>
<p>而allpication.yml里的配置,使用了git服务，uri下的git仓库存放了不同的配置文件,命名规则：{application}-{profile}.yml<br><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">spring</span>:</span><br><span class="line">  <span class="attribute">cloud</span>:</span><br><span class="line">    <span class="attribute">config</span>:</span><br><span class="line">      <span class="attribute">server</span>:</span><br><span class="line">        <span class="attribute">git</span>:</span><br><span class="line">          <span class="attribute">uri</span>: <span class="attribute">https</span>:<span class="comment">//git.coding.net/twogoods/ConfigService.git</span></span><br><span class="line">          <span class="attribute">username</span>: xxx</span><br><span class="line">          <span class="attribute">password</span>: yyy</span><br></pre></td></tr></table></figure></p>
<p>文档里除了application和profile外还有一个lable，lable主要是一个版本信息，若使用git做服务，lable就是不同的分支<br>启动这个服务，配置服务是否成功可以通过url查看：<a href="http://localhost:9999/{application}/{profile}[/{label}" target="_blank" rel="external">http://localhost:9999/{application}/{profile}[/{label}</a>]<br>当使用这个配置服务时，可以增加配置<code>spring.cloud.config.uri: http://myconfigserver.com</code>或者启动增加jvm参数<code>-Dspring.cloud.config.profile=test -Dspring.cloud.config.uri=http://127.0.0.1:9999/</code></p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[nginx]]></title>
      <url>http://twogoods.github.io/2016/03/02/nginx/</url>
      <content type="html"><![CDATA[<p>nginx是著名的反向代理服务器，负载均衡利器，利用一些脚本甚至可以实现动态的负载均衡。这里只是记一下入门的helloworld。  </p>
<p>启动nginx ，sudo nginx ;访问localhost:8080 发现已出现nginx的欢迎页面了。<br>配置文件：/usr/local/etc/nginx/nginx.conf<br><a id="more"></a><br>重新加载配置|重启|停止|退出 nginx<br>nginx -s reload|reopen|stop|quit<br><figure class="highlight axapta"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">server</span> &#123;</span><br><span class="line">        listen       <span class="number">9001</span>; 监听的端口</span><br><span class="line">        server_name  banka;</span><br><span class="line">        location / &#123;</span><br><span class="line">        	proxy_pass http:<span class="comment">//local_tomcat; 指向upstream</span></span><br><span class="line">            root   html;</span><br><span class="line">            <span class="keyword">index</span>  <span class="keyword">index</span>.html <span class="keyword">index</span>.htm;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    upstream local_tomcat &#123;  <span class="comment">//配了两个服务，weight为比重</span></span><br><span class="line">	    <span class="keyword">server</span> localhost:<span class="number">8080</span> weight=<span class="number">1</span>;  </span><br><span class="line">	    <span class="keyword">server</span> localhost:<span class="number">10000</span> weight=<span class="number">1</span>;  </span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure></p>
<p>多加一个服务名如mi,代理访问localhost:9000/mi/demo，实际访问的是localhost:8080/demo/。</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span>       <span class="number">9001</span>;</span><br><span class="line">    <span class="attribute">server_name</span>  banka;</span><br><span class="line">    <span class="attribute">location</span><span class="regexp"> ^~</span> /mi/ &#123;</span><br><span class="line">    	<span class="attribute">proxy_pass</span> http://localhost:8080/;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[聊一聊体育运动与新的一年]]></title>
      <url>http://twogoods.github.io/2016/02/28/2016-newyear/</url>
      <content type="html"><![CDATA[<p>过了个年，这不又长膘了，哈哈~仔细想想也好久没运动了，从7月正式实习一直到现在都没正儿八经的运动过一场，惭愧惭愧。要不是在家里，电视这种神奇的东西也是看不见的，偶尔翻开CCTV-5看看，才想起来，哟，今年是奥运年了啊。</p>
<h3 id="体育运动"><a href="#体育运动" class="headerlink" title="体育运动"></a>体育运动</h3><blockquote>
<p>体育运动是人类最伟大的发明</p>
</blockquote>
<p><a id="more"></a> 我不知道有没有前人说过这句话，如果没有那自然是最好的，我以后就可以得意的在后面属上我的名字。喜欢体育是从篮球开始的，那是06年，一晃整整10年。还记得初中高中时代特喜欢打篮球，甚至高中就敢翘一些无关紧要的课去打球，然后被班主任抓到办公室罚站，看来哥也年轻过啊，哈哈~  </p>
<p>体育运动最迷人的就是不确定性，你永远不知道下一刻会发生什么，赢家到底是谁。篮球场上的绝杀球总是激动人心的，足球场上完美的脚下技术也让人赏心悦目。多年的看球经历才让我总结出来上面这句话，而对于我们这种平凡人，时常运动健健康康的就好。前年跟好朋友去看了一场绿城跟恒大的比赛，今年我想去现场看一场篮球比赛，哪怕CBA也好。</p>
<h3 id="新的一年"><a href="#新的一年" class="headerlink" title="新的一年"></a>新的一年</h3><blockquote>
<p>有人的地方就有江湖</p>
</blockquote>
<p>最后一个学期，本科就毕业了，不出意外书还是会继续读下去。新的一年还是希望跟同学，好朋友有多一点相处的时间，毕竟有些人可能这辈子都不会再有交集了，当然也期待着接下来遇到一些更牛逼的人。有聚就会有散，聚是一盆火，散是满天星，英雄惜英雄，相忘于江湖。</p>
<h3 id="最后"><a href="#最后" class="headerlink" title="最后"></a>最后</h3><p>四年其实真的挺快的，转眼即逝。新的一年各位身体健康，工作学习顺利，我呢得把当初对体育运动的热情找回来，好好动动身体，锻炼锻炼，身体是革命的本钱啊。有了好身体，革命就得继续下去，人说不忘初心，那就得继续努力啊，傻逼程序员，哈哈~</p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[git flow]]></title>
      <url>http://twogoods.github.io/2016/01/05/git-flow/</url>
      <content type="html"><![CDATA[<p>用过git，那么肯定要碰到gitflow，gitflow个人认为是多人协作下使用git的一个规范，完全就是git操作，不过安装git flow后特定的命令可以帮我们做很多的事情，理解可以参考阮一峰的<a href="http://www.ruanyifeng.com/blog/2012/07/git.html" target="_blank" rel="external">文章</a>。  </p>
<p>功能开发<br><figure class="highlight vala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"># 初始化工作目录(一直回车即可)</span></span><br><span class="line">git flow init </span><br><span class="line"><span class="meta"># 开始创建新的需求分支(这个会从develop分出来，创建新的分支)</span></span><br><span class="line">git flow feature start editimage #这时项目会自动切换 feature/editimage分支</span><br><span class="line"><span class="meta"># 更改部分代码后</span></span><br><span class="line"><span class="meta"># git commit -a -m "修改完了"</span></span><br><span class="line"><span class="meta"># 完成开发分支合并develop(自动完成,只合并到develop，没有合并到master)</span></span><br><span class="line">git flow feature finish editimage</span><br><span class="line"><span class="meta"># 发布到远程开发分支</span></span><br><span class="line">git push origin develop</span><br></pre></td></tr></table></figure></p>
<a id="more"></a>
<p>bug修复<br><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">    </span><br><span class="line"><span class="comment"># 切换到master分支</span></span><br><span class="line">git checkout <span class="keyword">master</span></span><br><span class="line"><span class="title"># 更新master</span>分支</span><br><span class="line">git pull origin <span class="literal">master</span>（更新<span class="literal">master</span>分支为最新） </span><br><span class="line"><span class="comment">#生成一个hotfix分支(这个从master分支上切出来，不是从develop)</span></span><br><span class="line">git flow hotfix <span class="literal">start</span> hfx     </span><br><span class="line"><span class="comment"># 最终修改完成后，结束hotfix以供发布(修改后的代码会自动合并到master和develop两个分支)</span></span><br><span class="line">git flow hotfix finish hfx</span><br><span class="line">﻿<span class="comment"># 发布最终的master分支和develop分支</span></span><br><span class="line">git push origin <span class="keyword">master</span></span><br><span class="line"><span class="title">git</span> push origin develop</span><br></pre></td></tr></table></figure></p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[mybatis中的几个问题]]></title>
      <url>http://twogoods.github.io/2015/12/07/mybatis/</url>
      <content type="html"><![CDATA[<p>公司里用mybatis，写着写着会有几个问题冒出来，终于有空去看了一下源代码。</p>
<ul>
<li>mybatis 方法签名返回list，LinkedList，如何实现不同的list?<br>解：单纯使用mybatis时  <code>List&lt;Object&gt; user = session.selectList(statement);</code>  只能返回list且实际为arraylist<a id="more"></a>
<code>org.apache.ibatis.executor.resultset.DefaultResultSetHandler</code>里<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">  public <span class="built_in">List</span>&lt;<span class="built_in">Object</span>&gt; handleResultSets(Statement stmt) throws SQLException &#123;</span><br><span class="line">    ErrorContext.instance().activity(<span class="string">"handling results"</span>).object(mappedStatement.getId());</span><br><span class="line">    <span class="keyword">final</span> <span class="built_in">List</span>&lt;<span class="built_in">Object</span>&gt; multipleResults = <span class="keyword">new</span> ArrayList&lt;<span class="built_in">Object</span>&gt;();</span><br><span class="line">    <span class="built_in">int</span> resultSetCount = <span class="number">0</span>;</span><br><span class="line">    ResultSetWrapper rsw = getFirstResultSet(stmt);</span><br><span class="line">    <span class="built_in">List</span>&lt;ResultMap&gt; resultMaps = mappedStatement.getResultMaps();</span><br><span class="line">    <span class="built_in">int</span> resultMapCount = resultMaps.size();</span><br><span class="line">    validateResultMapsCount(rsw, resultMapCount);</span><br><span class="line">    <span class="keyword">while</span> (rsw != <span class="keyword">null</span> &amp;&amp; resultMapCount &gt; resultSetCount) &#123;</span><br><span class="line">      ResultMap resultMap = resultMaps.<span class="keyword">get</span>(resultSetCount);</span><br><span class="line">      handleResultSet(rsw, resultMap, multipleResults, <span class="keyword">null</span>);</span><br><span class="line">      rsw = getNextResultSet(stmt);</span><br><span class="line">      cleanUpAfterHandlingResultSet();</span><br><span class="line">      resultSetCount++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">String</span>[] resultSets = mappedStatement.getResulSets();</span><br><span class="line">    <span class="keyword">if</span> (resultSets != <span class="keyword">null</span>) &#123;</span><br><span class="line">      <span class="keyword">while</span> (rsw != <span class="keyword">null</span> &amp;&amp; resultSetCount &lt; resultSets.length) &#123;</span><br><span class="line">        ResultMapping parentMapping = nextResultMaps.<span class="keyword">get</span>(resultSets[resultSetCount]);</span><br><span class="line">        <span class="keyword">if</span> (parentMapping != <span class="keyword">null</span>) &#123;</span><br><span class="line">          <span class="built_in">String</span> nestedResultMapId = parentMapping.getNestedResultMapId();</span><br><span class="line">          ResultMap resultMap = configuration.getResultMap(nestedResultMapId);</span><br><span class="line">          handleResultSet(rsw, resultMap, <span class="keyword">null</span>, parentMapping);</span><br><span class="line">        &#125;</span><br><span class="line">        rsw = getNextResultSet(stmt);</span><br><span class="line">        cleanUpAfterHandlingResultSet();</span><br><span class="line">        resultSetCount++;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> collapseSingleResultList(multipleResults);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>配合spring时，实际的sqlSession是一个代理，在SqlSessionTemplate能看到sqlSessionProxy这个代理类，并且代理类里有一个实现InvocationHandler的SqlSessionInterceptor。spring读取配置初始化<code>MapperFactoryBean</code>,方法执行完后对返回类型转换。<code>org.apache.ibatis.binding.MapperMethod</code> 里关于方法返回不同类型集合的转换MapperProxy的invoke方法里调mapperMethod.execute()。<br><figure class="highlight monkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">@Override</span><br><span class="line"><span class="keyword">public</span> Object invoke(Object proxy, <span class="function"><span class="keyword">Method</span> <span class="title">method</span>, <span class="title">Object</span>[] <span class="title">args</span>) <span class="title">throws</span> <span class="title">Throwable</span> &#123;</span></span><br><span class="line">  <span class="keyword">if</span> (Object.class.equals(<span class="function"><span class="keyword">method</span>.<span class="title">getDeclaringClass</span>(</span>))) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="function"><span class="keyword">method</span>.<span class="title">invoke</span>(</span>this, args);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Throwable t) &#123;</span><br><span class="line">      <span class="keyword">throw</span> ExceptionUtil.unwrapThrowable(t);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">final</span> MapperMethod mapperMethod = cachedMapperMethod(<span class="function"><span class="keyword">method</span>);</span></span><br><span class="line">  <span class="keyword">return</span> mapperMethod.execute(sqlSession, args);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<figure class="highlight nimrod"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">private &lt;E&gt; <span class="type">Object</span> executeForMany(<span class="type">SqlSession</span> sqlSession, <span class="type">Object</span>[] args) &#123;</span><br><span class="line">  <span class="type">List</span>&lt;E&gt; <span class="literal">result</span>;</span><br><span class="line">  <span class="type">Object</span> param = <span class="keyword">method</span>.convertArgsToSqlCommandParam(args);</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">method</span>.hasRowBounds()) &#123;</span><br><span class="line">    <span class="type">RowBounds</span> rowBounds = <span class="keyword">method</span>.extractRowBounds(args);</span><br><span class="line">    <span class="literal">result</span> = sqlSession.&lt;E&gt;selectList(command.getName(), param, rowBounds);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="literal">result</span> = sqlSession.&lt;E&gt;selectList(command.getName(), param);</span><br><span class="line">  &#125;</span><br><span class="line">  // issue <span class="comment">#510 Collections &amp; arrays support</span></span><br><span class="line">  <span class="keyword">if</span> (!<span class="keyword">method</span>.getReturnType().isAssignableFrom(<span class="literal">result</span>.getClass())) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">method</span>.getReturnType().isArray()) &#123;</span><br><span class="line">      <span class="keyword">return</span> convertToArray(<span class="literal">result</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> convertToDeclaredCollection(sqlSession.getConfiguration(), <span class="literal">result</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">result</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>resulttype为map时，map里的泛型<string,object>,<string,string>如何转化？<br>解：配置有 resultType=”java.util.Map” xml配置会组装在类 <code>MappedStatement</code> mybatis 把结果包装成<code>Map&lt;Object,Object&gt;</code></string,string></string,object></li>
</ul>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[springboot]]></title>
      <url>http://twogoods.github.io/2015/11/04/springboot/</url>
      <content type="html"><![CDATA[<p><a href="http://www.searchsoa.com.cn/2015soamicroservice/index.html" target="_blank" rel="external">关于微服务</a>及<a href="https://www.gitbook.com/book/qbgbook/spring-boot-reference-guide-zh/details" target="_blank" rel="external">中文文档</a>。这里也有一个关于微服务的<a href="http://dockone.io/article/1066" target="_blank" rel="external">系列文章</a>，写的很不错，值得一读。<a id="more"></a>  </p>
<p>跟着文档可以快速的上手。springboot确实可以快速的构建一个工程，过程中遇到的一个问题就是配置文件，springboot推荐使用<code>.properities</code>或<code>yml</code>两种方式。配置文件中会分别配置测试与生产环境，如下是一个完整的配置：<br><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="comment">#mvn spring-boot:run 时会使用此配置</span></span><br><span class="line"><span class="attr">datasource:</span></span><br><span class="line">  <span class="number">51</span>banka:</span><br><span class="line"><span class="attr">    driverClassName:</span> com.mysql.jdbc.Driver</span><br><span class="line"><span class="attr">    url:</span> jdbc:mysql://<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">3310</span>/test</span><br><span class="line">    username : root</span><br><span class="line">    password :</span><br><span class="line">    initialSize : <span class="number">10</span></span><br><span class="line">    maxActive : <span class="number">10</span></span><br><span class="line">    maxIdle : <span class="number">10</span></span><br><span class="line">    minIdle : <span class="number">10</span></span><br><span class="line"></span><br><span class="line">spring.view.prefix: /WEB-INF/jsp/</span><br><span class="line">spring.view.suffix: .jsp</span><br><span class="line"></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line"><span class="attr">  port:</span> <span class="number">10000</span></span><br><span class="line"><span class="attr">  contextPath:</span> /bankaservice</span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="comment">#测试环境的配置，打包成jar 使用 java -jar -Dspring.profiles.active=development target/test.jar 启动</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line"><span class="attr">    profiles:</span> development</span><br><span class="line"><span class="attr">datasource:</span></span><br><span class="line">  <span class="number">51</span>banka:</span><br><span class="line"><span class="attr">    driverClassName:</span> com.mysql.jdbc.Driver</span><br><span class="line"><span class="attr">    url:</span> jdbc:mysql://<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">3310</span>/test</span><br><span class="line">    username : root</span><br><span class="line">    password :</span><br><span class="line">    initialSize : <span class="number">10</span></span><br><span class="line">    maxActive : <span class="number">10</span></span><br><span class="line">    maxIdle : <span class="number">10</span></span><br><span class="line">    minIdle : <span class="number">10</span></span><br><span class="line"></span><br><span class="line">spring.view.prefix: /WEB-INF/jsp/</span><br><span class="line">spring.view.suffix: .jsp</span><br><span class="line"></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line"><span class="attr">  port:</span> <span class="number">10000</span></span><br><span class="line"><span class="attr">  contextPath:</span> /test</span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="comment"># 生产环境</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line"><span class="attr">    profiles:</span> production</span><br><span class="line"><span class="attr">datasource:</span></span><br><span class="line">  <span class="number">51</span>banka:</span><br><span class="line"><span class="attr">    driverClassName:</span> com.mysql.jdbc.Driver</span><br><span class="line"><span class="attr">    url:</span> jdbc:mysql://<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">3310</span>/test</span><br><span class="line">    username : root</span><br><span class="line">    password : </span><br><span class="line">    initialSize : <span class="number">30</span></span><br><span class="line">    maxActive : <span class="number">40</span></span><br><span class="line">    maxIdle : <span class="number">40</span></span><br><span class="line">    minIdle : <span class="number">30</span></span><br><span class="line"></span><br><span class="line">spring.view.prefix: /WEB-INF/jsp/</span><br><span class="line">spring.view.suffix: .jsp</span><br><span class="line"></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line"><span class="attr">  port:</span> <span class="number">8080</span></span><br><span class="line"><span class="attr">  contextPath:</span> /test</span><br></pre></td></tr></table></figure></p>
<p>另文档的这一处:<br> JSP的限制<br>在内嵌的servlet容器中运行一个Spring Boot应用时（并打包成一个可执行的存档archive），容器对JSP的支持有一些限制。</p>
<ul>
<li>tomcat只支持war的打包方式，不支持可执行的jar</li>
<li>内嵌的Jetty目前不支持JSP</li>
<li>Undertow不支持JSP<br>所以为了防坑还是跳过jsp用别的模板吧</li>
</ul>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[一些整理]]></title>
      <url>http://twogoods.github.io/2015/10/17/%E5%B0%8F%E6%95%B4%E7%90%86/</url>
      <content type="html"><![CDATA[<p>看了《java并发编程实战》确实有一些可以梳理，也可以通过jdk的源码得到答案。  </p>
<ul>
<li><p>java voliate关键字与指令重排序  </p>
<p>缓存一致性问题和指令重排序的问题<a href="http://my.oschina.net/chihz/blog/58035" target="_blank" rel="external">解释1</a>,<a href="http://www.cnblogs.com/dolphin0520/p/3920373.html" target="_blank" rel="external">解释2</a></p>
</li>
<li><p>hashmap的<a href="http://www.360doc.com/content/10/0505/19/495229_26234886.shtml" target="_blank" rel="external">实现</a>，<a href="http://www.nowcoder.com/discuss/1808?type=1&amp;order=0&amp;pos=28&amp;page=0" target="_blank" rel="external">另一个</a></p>
</li>
<li><p><a href="http://ifeve.com/concurrenthashmap/" target="_blank" rel="external">concurrenthashmap的实现</a></p>
</li>
<li><a href="http://ifeve.com/java-copy-on-write/" target="_blank" rel="external">copyonwrite</a>,写时复制，读时不加锁，所以读可能是旧值，只保证最终一致性，不能保证数据的实时一致性，适合读多写少的并发场景</li>
<li>java内存泄露：<figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//person 利用名字，年龄等属性重写了hashcode方法</span></span><br><span class="line">HashSet&lt;Person&gt; hs=<span class="literal">new</span> HashSet&lt;Person&gt;();</span><br><span class="line">Person p=<span class="literal">new</span> Person(<span class="string">"张三"</span>,<span class="number">25</span>);</span><br><span class="line">p.setAge(<span class="number">10</span>);</span><br><span class="line">hs.remove(p);</span><br><span class="line"><span class="comment">//这里会无法删除，修改属性后hashcode变了，也就无法找到并删除这个对象了</span></span><br><span class="line"><span class="comment">//-----或者想下面这样--------</span></span><br><span class="line"><span class="built_in">Map</span> <span class="built_in">map</span> = <span class="literal">new</span> HashMap();</span><br><span class="line"><span class="comment">//key未重写hashcode和equal方法</span></span><br><span class="line"><span class="comment">//直接这样增加的话，没有new Key()的这样引用，永远无法取出来和移除这个键值对</span></span><br><span class="line"><span class="built_in">map</span>.put(<span class="literal">new</span> Key(<span class="string">"key"</span>), <span class="string">"value"</span>);</span><br></pre></td></tr></table></figure></li>
</ul>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[一个简易的博客]]></title>
      <url>http://twogoods.github.io/2015/08/04/bolg/</url>
      <content type="html"><![CDATA[<p>很不要脸的拿了一大堆轮子造了个不像博客的博客，当然不是你现在看到的这个啦，不管怎样还是花了心思的，所以简单的说一说。<br>这东西是平常有空全凭兴趣搞的，当初主要是想弄个班级的展示页面，发现就一个页面的话也太单调了，想到给一些自定义内容的功能吧，这么一来二去就变成了这个博客。<br>说起来自己主要是搞java的，这活主要还是前端的活，但当初在学的时候一些基本的html,css,js都了解过，虽说不是举步维艰但也确实是不太熟悉。java总是跟企业级开发联系在一起，拿它写似乎也没必要，这不正好也了解过一点node拿来写写简单的逻辑还是可以的，这个博客也就算是自己学node的一个helloworld吧。  </p>
<ul>
<li><a href="http://tgblog.coding.io" target="_blank" rel="external">演示</a></li>
<li><a href="https://github.com/twogoods/tgblog" target="_blank" rel="external">代码</a></li>
</ul>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[跨域请求jsonp]]></title>
      <url>http://twogoods.github.io/2015/07/22/jsonp/</url>
      <content type="html"><![CDATA[<p>一次面试的时候被问到了跨域请求，提到了jsonp但一直没好好去看，今天再一次碰到这个，就好好的了解了一下。<br>这篇文章讲了<a href="http://www.cnblogs.com/yuzhongwusan/archive/2012/12/11/2812849.html" target="_blank" rel="external">原理</a>，而且比较容易懂,推荐一看。<br>jsonp主要是利用<code>&lt;script type=&quot;text/javascript&quot; src=&quot;scripts/jquery.min.js&quot;&gt;&lt;/script&gt;</code><br>中的src可以跨域获取数据，既然是通过script标签的src属性来请求，那么当然jsonp只有get方式的请求喽。</p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[git的基本操作]]></title>
      <url>http://twogoods.github.io/2015/07/02/git/</url>
      <content type="html"><![CDATA[<ol>
<li>设置Git的user name和email：<br><code>$ git config --global user.name &quot;XXX&quot;</code><br><code>$ git config --global user.email &quot;XXX@gmail.com&quot;</code></li>
<li>键入命令：<code>ssh-keygen -t rsa -C &quot;email@email.com&quot;</code><br><code>email@email.com</code>是git账号；</li>
<li>提醒你输入key的名称，输入如<code>id_rsa</code>；</li>
<li>在用户user目录下产生两个文件：<code>id_rsa</code>和<code>id_rsa.pub</code>；</li>
<li>用打开id_rsa.pub文件，复制内容，在github.com的网站上到ssh密钥管理页面，添加新公钥，随便取个名字，内容粘贴刚才复制的内容；</li>
</ol>
<p>基本操作：<br>创建     <code>git init</code><br>添加到版本库      <code>git add readme.txt</code><br>提交到本地    <code>git commit -m &quot;fiorst commit&quot;</code><br>版本回退      <code>git reset --hard commit_id（head、head^、head~100）</code><br>查看状态     <code>git status</code><br>克隆        <code>git clone XXXXX</code><br>撤销文件的修改     <code>git checkout -- readme.txt</code><br><a id="more"></a><br>创建分支     <code>git branch &quot;name&quot;</code><br>切换分支        <code>git checkout &quot;name&quot;</code><br>创建分支+切换      <code>git checkout -b &quot;branchname&quot;</code><br>合并某分支到当前分支    <code>git merge &quot;name&quot;</code><br>删除分支        <code>git branch -d &quot;name&quot;</code><br>查看分支       <code>git branch</code><br>查看分支图    <code>git log --graph</code><br>添加远程库    <code>git remote add origin https://git……</code><br>这里也有阮大神的<a href="http://www.ruanyifeng.com/blog/2015/12/git-cheat-sheet.html" target="_blank" rel="external">总结</a><br>最后，不忘出处，学git当然要看<a href="http://www.liaoxuefeng.com/wiki/0013739516305929606dd18361248578c67b8067c8c017b000/" target="_blank" rel="external">廖雪峰</a>啦。</p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[redis的安装]]></title>
      <url>http://twogoods.github.io/2015/06/28/redis/</url>
      <content type="html"><![CDATA[<p>一个新东西入门总不是那样简单的，从下载，安装到完成helloworld的过程总是要花些时间的，记下来供以后参考。<a id="more"></a> </p>
<h3 id="下载"><a href="#下载" class="headerlink" title="下载"></a>下载</h3><p>下载肯定是去看看<a href="http://redis.io" target="_blank" rel="external">redis</a>官网啦,不过官网却并没有官方的Windows版本，提供了 Microsoft Open Tech团队的贡献的windows版本的<a href="https://github.com/MSOpenTech/redis" target="_blank" rel="external">链接</a>，可以在这里<a href="https://github.com/MSOpenTech/redis/releases" target="_blank" rel="external">下载</a>msi安装包。一些老的博客上的下载地址会指向<a href="https://github.com/dmajkic/redis" target="_blank" rel="external">这个</a>，不过已经很久没维护了，文档也说了正式的应该是上一个Open Tech团队的。</p>
<h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><p>确定好要下载哪个后，就是安装了，msi安装文件就非常方便，直接安装并且功能添加到了系统服务中。如果是zip版本跟着文档手动的也可以很快的安装，添加服务。安装好后，命令行进入redis目录，使用命令<code>redis-server.exe redis.windows-service.conf</code>开启服务（当然添加了服务也可以去系统服务里打开），接下来就可以做一个简单的测试了<br><figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">redis-cli.exe -h <span class="number">192.168</span><span class="number">.7</span><span class="number">.83</span> -p <span class="number">6379</span>  <span class="comment">//连接服务，注意IP</span></span><br><span class="line"><span class="keyword">set</span> name <span class="comment">haha</span>   //添加键值对</span><br><span class="line">get <span class="comment">name</span>        //得到键为<span class="comment">name</span>的值</span><br></pre></td></tr></table></figure></p>
<p>到这来算是把redis装好了。<br>ps:后来到公司用上了高大上的Mac，mac下安装就容易多了，直接brew安装。<br>一些基本的命令，集群的配置在这个翻译好的<a href="http://redisdoc.com/" target="_blank" rel="external">网站</a>上都有。</p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[Java中IO的异常处理]]></title>
      <url>http://twogoods.github.io/2015/05/08/exceptionmodel/</url>
      <content type="html"><![CDATA[<ol>
<li><p>平时都不太注意异常的处理，随意的try-catch一下，就像这样</p>
<figure class="highlight julia"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">	<span class="keyword">try</span> &#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">10</span> / i;</span><br><span class="line">&#125; <span class="keyword">catch</span> (<span class="built_in">Exception</span> <span class="literal">e</span>) &#123;</span><br><span class="line">	<span class="literal">e</span>.printStackTrace();</span><br><span class="line">&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>真正在项目中如果就这样异常的信息只打印在了控制台，log上是没有的，一般都会这样</p>
<a id="more"></a>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">	<span class="keyword">try</span> &#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">10</span> / i;</span><br><span class="line">&#125; <span class="keyword">catch</span> (<span class="keyword">Exception</span> ex) &#123;</span><br><span class="line">	<span class="keyword">throw</span> <span class="keyword">new</span> <span class="keyword">Exception</span>(<span class="string">"exception"</span>);</span><br><span class="line">&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>try-catch后重新抛出一个异常（当然最好自己定义一个异常类，抛出自己定义的异常），一层一层抛，最后可以统一处理异常。</p>
</li>
<li>io中的异常处理：<br>在涉及java的io时会遇到各种异常的try-catch典型的写法是这样<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">InputStream input = <span class="keyword">null</span>;</span><br><span class="line">OutputStream output = <span class="keyword">null</span>;</span><br><span class="line"><span class="keyword">byte</span>[] buffer=<span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">1024</span>];</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">	input = <span class="keyword">new</span> FileInputStream(<span class="string">"XXX"</span>);</span><br><span class="line">	output = <span class="keyword">new</span> FileOutputStream(<span class="string">"YYY"</span>);</span><br><span class="line">	<span class="keyword">while</span>(input.<span class="keyword">read</span>(buffer) != -<span class="number">1</span>) &#123;</span><br><span class="line">		output.<span class="keyword">write</span>(buffer);</span><br><span class="line">	&#125;</span><br><span class="line">&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">	<span class="keyword">if</span> (input != <span class="keyword">null</span>) &#123;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			input.close();</span><br><span class="line">		&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> (output != <span class="keyword">null</span>) &#123;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			output.close();</span><br><span class="line">		&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>由于要处理各种异常，代码变的特别丑陋，这里异常处理模板也就是<strong>模板方法</strong>的设计模式就派上用场了<br>模板1：抽象类<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">InputStreamProcessingTemplate</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">process</span><span class="params">(String fileName)</span> </span>&#123;</span><br><span class="line">		InputStream input = <span class="keyword">null</span>;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			input = <span class="keyword">new</span> FileInputStream(fileName);</span><br><span class="line">			doProcess(input);</span><br><span class="line">		&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">		&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">			<span class="keyword">if</span> (input != <span class="keyword">null</span>) &#123;</span><br><span class="line">				<span class="keyword">try</span> &#123;</span><br><span class="line">					input.close();</span><br><span class="line">				&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">doProcess</span><span class="params">(InputStream input)</span></span><br><span class="line">	<span class="keyword">throws</span> IOException</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>接下来如何使用<br><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> InputStreamProcessingTemplate()&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">doProcess</span><span class="params">(InputStream input)</span></span><br><span class="line">        <span class="keyword">throws</span> IOException</span>&#123;</span><br><span class="line">            <span class="keyword">int</span> inChar = input.read();</span><br><span class="line">            <span class="keyword">while</span>(inChar !- <span class="number">-1</span>)&#123;</span><br><span class="line">                <span class="comment">//do something with the chars...</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;.process(<span class="string">"someFile.txt"</span>);</span><br></pre></td></tr></table></figure></p>
<p>模板2：接口方式<br>先统一声明一个处理具体业务代码的接口,流怎么使用都在这里实现<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">InputStreamProcessor</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">process</span><span class="params">(InputStream input)</span> <span class="keyword">throws</span> IOException</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>处理模板<br><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">InputStreamProcessingTemplate2</span> &#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">process</span>(<span class="params">String fileName,</span><br><span class="line">	InputStreamProcessor processor</span>)</span>&#123;</span><br><span class="line">		InputStream input = <span class="literal">null</span>;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			input = <span class="keyword">new</span> FileInputStream(fileName);</span><br><span class="line">			processor.process(input);</span><br><span class="line">		&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">		&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">			<span class="keyword">if</span> (input != <span class="literal">null</span>) &#123;</span><br><span class="line">				<span class="keyword">try</span> &#123;</span><br><span class="line">					input.close();</span><br><span class="line">				&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>具体使用传入匿名内部类<br><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">InputStreamProcessingTemplate2</span><span class="selector-class">.process</span>(<span class="string">"e://1.txt"</span>,</span><br><span class="line">            new InputStreamProcessor() &#123;</span><br><span class="line">			<span class="variable">@Override</span></span><br><span class="line">			public void process(InputStream input)</span><br><span class="line">			throws IOException &#123;</span><br><span class="line">				int data = input<span class="selector-class">.read</span>();</span><br><span class="line">				<span class="selector-tag">while</span> (data != -<span class="number">1</span>) &#123;</span><br><span class="line">					System<span class="selector-class">.out</span><span class="selector-class">.println</span>((char) data);</span><br><span class="line">					data = input<span class="selector-class">.read</span>();</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;);</span><br></pre></td></tr></table></figure></p>
<p>这样一来我们使得代码就变得比较整洁,当然java这样一来我们使得代码就变得比较整洁，当然从Java7开始，一种新的被称作“try-with-resource”的异常处理机制被引入进来，也可以像这样使用，它会确保流在使用完被正确关闭。<br><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">try(FileInputStream <span class="keyword">input</span> = new FileInputStream(<span class="string">"file.txt"</span>)) &#123;</span><br><span class="line">	        int data = <span class="keyword">input</span>.<span class="keyword">read</span>();</span><br><span class="line">	        <span class="keyword">while</span>(data != -1)&#123;</span><br><span class="line">	            System.<span class="keyword">out</span>.<span class="keyword">print</span>((<span class="keyword">char</span>) data);</span><br><span class="line">	            data = <span class="keyword">input</span>.<span class="keyword">read</span>();</span><br><span class="line">	        &#125;</span><br><span class="line">	    &#125; catch (IOException <span class="keyword">e</span>) &#123;</span><br><span class="line">			<span class="keyword">e</span>.printStackTrace();</span><br><span class="line">		&#125;</span><br></pre></td></tr></table></figure></p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[Node初步]]></title>
      <url>http://twogoods.github.io/2015/04/20/startNode/</url>
      <content type="html"><![CDATA[<p>其实node在去年就接触过了，最近想进一步接触了解一下，发现菜鸟时遇到的问题还是有必要记一下。</p>
<p>全局安装express：<br> <code>npm install -g express</code><br> express 安装好后命令行还不能使用express命令，需安装express-generato包：<br>  <code>npm install -g express-generator</code><br>  启动express：<br>  <code>npm start</code><br>  当修改代码时每次都要重启服务器会很不方便，node有一个小工具supervisor，安装后使用此工具会根据代码的改动自动重新部署。<br>  安装supervisor：<br>  <code>npm -g install supervisor</code><br>在 package.json里有这样的代码<br><figure class="highlight xquery"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"scripts"</span>: &#123;</span><br><span class="line"><span class="string">"start"</span>: <span class="string">"node ./bin/www"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>  所以我们可以使用如下命令来启动express：<br><code>supervisor node ./bin/www</code></p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[理解java中的回调]]></title>
      <url>http://twogoods.github.io/2015/03/12/callback/</url>
      <content type="html"><![CDATA[<p>在《java编程思想》一书中时不时的提到设计模式，书中也出现了回调，在学习的时候经常听到这个词，也有必要真正去弄明白什么叫<strong>回调</strong>？<br><strong>回调</strong>用一句话解释就是，被调用方在被调用时也会调用对方。形象一点说”If you call me, i will call back”。举个生活中简单的例子：有一位老板很忙，他没有时间盯着员工干活，然后他告诉自己的雇员，干完当前这些事情后，告诉他干活的结果。<br>接下来的代码演示了这个过程：<br><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span><br><span class="line"> * 回调接口,指明用什么方式跟老板汇报，所以老板应该实现这个接口</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title">CallBackInterface</span> &#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">callback</span>(<span class="params"></span>)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<a id="more"></a>
<p>接下来是老板类<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Boss</span> <span class="keyword">implements</span> <span class="title">CallBackInterface</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> Employee employee;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">Boss</span><span class="params">(Employee employee)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.employee=employee;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//简单得实现callback</span></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">callback</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"老板，做完了"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//发命令让员工做事</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doaction</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="comment">//将CallBackInterface接口告诉了employee</span></span><br><span class="line">		employee.doSomeThing(<span class="keyword">this</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		Employee employee=<span class="keyword">new</span> Employee();</span><br><span class="line">		Boss boss=<span class="keyword">new</span> Boss(employee);</span><br><span class="line">		boss.doaction();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>员工类，<br><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">public</span> <span class="selector-tag">class</span> <span class="selector-tag">Employee</span> &#123;</span><br><span class="line">	<span class="comment">//简单模拟做事的方法，做完执行回调</span></span><br><span class="line">	<span class="selector-tag">public</span> <span class="selector-tag">void</span> <span class="selector-tag">doSomeThing</span>(CallBackInterface cb)&#123;</span><br><span class="line">		System<span class="selector-class">.out</span><span class="selector-class">.println</span>(<span class="string">"干活。。"</span>);</span><br><span class="line">		System<span class="selector-class">.out</span><span class="selector-class">.println</span>(<span class="string">"干完了！"</span>);</span><br><span class="line">		cb<span class="selector-class">.callback</span>();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>测试：<br><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">      Employee employee=new Employee()<span class="comment">;</span></span><br><span class="line"><span class="keyword">Boss </span><span class="keyword">boss=new </span><span class="keyword">Boss(employee);</span><br><span class="line"></span><span class="keyword">boss.doaction();</span></span><br></pre></td></tr></table></figure></p>
<p>关于回调的作用网上的这段话至少让我有了一定的认识：我们在用框架的时候，一般直接调用框架提供的API就可以了，但回调不同，当框架不能满足需求，我们想让框架来调用自己的类方法，怎么做呢？总不至于去修改框架吧。许多优秀的框架提几乎都供了相关的接口，我们只需要实现相关接口，即可完成了注册，然后在合适的时候让框架来调用我们自己的类，还记不记得我们在使用Struts时，当我们编写Action时，就需要继承Action类，然后实现execute()方法，在execute()方法中写咱们自己的业务逻辑代码，完成对用户请求的处理。由此可以猜测，框架和容器中会提供大量的回调接口，以满足个性化的定制。</p>
<p>如struts2里Action的一个代理类DefaultActionInvocation中的invoke方法<br><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> String invoke() <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    String profileKey = <span class="string">"invoke: "</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        UtilTimerStack.<span class="keyword">push</span>(profileKey);</span><br><span class="line">        <span class="keyword">if</span> (executed) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(<span class="string">"Action has already executed"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//interceptors是包含所有拦截器的集合</span></span><br><span class="line">        <span class="keyword">if</span> (interceptors.hasNext()) &#123;</span><br><span class="line">            <span class="keyword">final</span> InterceptorMapping interceptor</span><br><span class="line">            = interceptors.<span class="keyword">next</span>();</span><br><span class="line">            String interceptorMsg = <span class="string">"interceptor: "</span> + interceptor.getName();</span><br><span class="line">            UtilTimerStack.<span class="keyword">push</span>(interceptorMsg);</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">            		<span class="comment">//调用拦截器的拦截方法</span></span><br><span class="line">                    resultCode = interceptor.getInterceptor().</span><br><span class="line">                    intercept(DefaultActionInvocation.<span class="keyword">this</span>);</span><br><span class="line">                        &#125;</span><br><span class="line">            <span class="keyword">finally</span> &#123;</span><br><span class="line">                UtilTimerStack.<span class="keyword">pop</span>(interceptorMsg);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            resultCode = invokeActionOnly();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (!executed) &#123;</span><br><span class="line">        <span class="comment">//此处代码略去</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> resultCode;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">finally</span> &#123;</span><br><span class="line">        UtilTimerStack.<span class="keyword">pop</span>(profileKey);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>下面是ModelDrivenInterceptor拦截器的intercept方法<br><figure class="highlight processing"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">String</span> intercept(ActionInvocation invocation)</span><br><span class="line"><span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="keyword">Object</span> action = invocation.getAction();</span><br><span class="line">    <span class="keyword">if</span> (action <span class="keyword">instanceof</span> ModelDriven) &#123;</span><br><span class="line">        ModelDriven modelDriven = (ModelDriven) action;</span><br><span class="line">        ValueStack stack = invocation.getStack();</span><br><span class="line">        <span class="keyword">Object</span> model = modelDriven.getModel();</span><br><span class="line">        <span class="keyword">if</span> (model !=  <span class="keyword">null</span>) &#123;</span><br><span class="line">        	stack.push(model);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (refreshModelBeforeResult) &#123;</span><br><span class="line">            invocation.addPreResultListener(</span><br><span class="line">            <span class="keyword">new</span> RefreshModelBeforeResult(modelDriven, model));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//明显此处是回调</span></span><br><span class="line">    <span class="keyword">return</span> invocation.invoke();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>这两段代码连起来看就很明确，struts2处理一个请求的时候会调用DefaultActionInvocation的invoke方法，这个方法会执行一个拦截器的intercept方法，由于调用这个方法的时候传入了invocation自身，使得拦截器里可以回调invocation的invoke的方法，也正是反复的回调使得interceptors集合里的所有拦截器都得到执行。</p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[迎接新的一年]]></title>
      <url>http://twogoods.github.io/2015/03/01/chinesenewyear/</url>
      <content type="html"><![CDATA[<p>　　今天是十一，没到十五理论上年还没过完呢，不过对于我们经历了史上最长寒假的大学生来说，年已经结束了。明天是星期一，开学的第一天。<br>　　回家了20天，除了同学聚会，过年走亲访友，每天就是宅在家里。当初还发微博说要在寒假里好好学习一下angular，可惜事与愿违，家里这就不是一个可以好好学习的地方。度过了这20天的隐居生活，回到学校的第一感受就是，哇塞，我们学校好多女生啊，而且都这么漂亮，好吧，我承认已经确实没看到这么多青春靓丽的女生了，单身狗伤不起啊。。。<br>　　这两天网上最火的就是神马duang,白金还是蓝黑，别欺负我们这种眼镜党好不，分明就是白金的。好了，不瞎扯了，印象最深刻的还是昨天柴静的那个纪录片《<a href="http://v.youku.com/v_show/id_XOTAxNTUxNTI0.html" target="_blank" rel="external">穹顶之下 同呼吸共命运</a>》，发人深思，久久不能平静。</p>
<blockquote>
<p>一个人应该这么活着：春天来的时候门开着，风进来，花香进来，颜色进来；有的时候你碰到雨，或者碰到雾的时候，你会忍不住想要往肺里面，深深的呼吸一口气，能感觉到那个碎雨的那个味道，又凛冽又清新。——柴静《穹顶之下》</p>
</blockquote>
<h3 id="关于新的一年"><a href="#关于新的一年" class="headerlink" title="关于新的一年"></a>关于新的一年</h3><p>　　对于新年计划在总结里提到过了，那些就不再重复了，新年有两个棘手的问题，学车，考研。现在的我学车真是腾不出时间，又不想浪费这毕业前的这段的时间，也无非就是想在毕业前多学点，争取毕业了有底气走向社会然而爸妈又希望我读研究生，所以面临的又一个问题就是要不要考研，现在我还是给不出答案，内心还是想现在多努力，不再去参加那样一场所谓的考试。<br>　　无论如何农历新年已经过去了，又一次离家，新的一年，希望一切都好，家人身体健康。</p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[javascript基础点]]></title>
      <url>http://twogoods.github.io/2015/02/10/2-10-JavaScript/</url>
      <content type="html"><![CDATA[<p>以下是自己学习JavaScript中遇到的问题，网上的这些博文给出了很好的解答，在此一并小计一下。<br>PS:《javascript高级程序设计》值得一读。</p>
<ol>
<li>立即执行函数(function(){…})() 与 (function(){…}()) 的区别？  <a href="http://segmentfault.com/q/1010000000442042" target="_blank" rel="external">解答</a></li>
<li><a href="http://segmentfault.com/blog/nightire/1190000000348228" target="_blank" rel="external">作用域的问题</a>  ，js里只有函数作用域：<figure class="highlight qml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">var</span> <span class="built_in">color</span>=<span class="string">"red"</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">change</span>(<span class="params">color</span>)</span>&#123;</span><br><span class="line"><span class="comment">/*</span><br><span class="line">在函数作用域内有一个color的局部变量。</span><br><span class="line">若不是这样，alert(color)使浏览器报color is not defined的错误</span><br><span class="line">*/</span></span><br><span class="line">	alert(<span class="built_in">color</span>);</span><br><span class="line">	<span class="built_in">color</span>=<span class="string">"blue"</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//这里是引用外部的全局变量</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">change2</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	<span class="built_in">color</span>=<span class="string">"blue"</span>;</span><br><span class="line">&#125;</span><br><span class="line">change();<span class="comment">// undefined</span></span><br><span class="line">change(<span class="built_in">color</span>);<span class="comment">// red</span></span><br><span class="line">change2();</span><br><span class="line">alert(<span class="built_in">color</span>);</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>在执行change()时声明了局部变量color但未初始化所以是undefined；执行change(color)时声明并初始化了局部变量所以是red,紧接着<code>color=&quot;blue&quot;</code>修改了局部变量的值.</p>
<ol>
<li><a href="http://www.ruanyifeng.com/blog/2009/08/learning_javascript_closures.html" target="_blank" rel="external">关于闭包</a>，说的通俗些闭包就是能够读取其他函数内部变量的函数。这里有进一步的<a href="https://cnodejs.org/topic/5482d05e73dcca8d21292928" target="_blank" rel="external">说明</a></li>
</ol>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[初学产品]]></title>
      <url>http://twogoods.github.io/2015/01/22/pm-start/</url>
      <content type="html"><![CDATA[<p>我也不知道我是什么时候知道产品经理这个词的，前不久又在微博上发现了这套视频，把他分享给大家，那么就从这里开始吧。。。  </p>
<h3 id="技术人的产品修练之路-第零讲"><a href="#技术人的产品修练之路-第零讲" class="headerlink" title="技术人的产品修练之路    第零讲"></a>技术人的产品修练之路    第零讲<a id="more"></a></h3><iframe src="http://www.tudou.com/programs/view/html5embed.action?type=0&code=aZQVWpVOEvo&lcode=&resourceId=366570488_06_05_99" allowtransparency="true" allowfullscreen="true" scrolling="no" border="0" frameborder="0" style="width:480px;height:400px;"></iframe>

<h3 id="技术人的产品修练之路-第一讲"><a href="#技术人的产品修练之路-第一讲" class="headerlink" title="技术人的产品修练之路    第一讲"></a>技术人的产品修练之路    第一讲</h3><iframe src="http://www.tudou.com/programs/view/html5embed.action?type=0&code=E50GcNAKMQc&lcode=&resourceId=366570488_06_05_99" allowtransparency="true" allowfullscreen="true" scrolling="no" border="0" frameborder="0" style="width:480px;height:400px;"></iframe>


<h3 id="技术人的产品修练之路-第二讲"><a href="#技术人的产品修练之路-第二讲" class="headerlink" title="技术人的产品修练之路    第二讲"></a>技术人的产品修练之路    第二讲</h3><iframe src="http://www.tudou.com/programs/view/html5embed.action?type=0&code=2gA6cEJddOc&lcode=&resourceId=366570488_06_05_99" allowtransparency="true" allowfullscreen="true" scrolling="no" border="0" frameborder="0" style="width:480px;height:400px;"></iframe>


<h3 id="技术人的产品修练之路-第三讲"><a href="#技术人的产品修练之路-第三讲" class="headerlink" title="技术人的产品修练之路    第三讲"></a>技术人的产品修练之路    第三讲</h3><iframe src="http://www.tudou.com/programs/view/html5embed.action?type=0&code=TymeE_VVdbY&lcode=&resourceId=366570488_06_05_99" allowtransparency="true" allowfullscreen="true" scrolling="no" border="0" frameborder="0" style="width:480px;height:400px;"></iframe>]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[为父亲们点赞]]></title>
      <url>http://twogoods.github.io/2015/01/02/2015-1-2/</url>
      <content type="html"><![CDATA[<p>　　今天中午跟好朋友在去食堂的路上，他说昨天他父亲早上八点给他打电话要来看他，当时他还谁在床上呢，说是在杭州打工正好过来看看他，下午一点就走了。我就好奇问：“这么快就走了，那你们都干嘛了？”，我朋友说，“就来看了看我住的情况啊，简单聊了聊，还给我洗衣服了。”<br>　　父亲难得来一趟，看了看孩子，聊了聊家常，帮孩子洗了衣服就走了。其实我很能想象当时那个场景，因为我和我父亲又未尝没有这样的情景出现过，父子间话不多，几句天冷了多穿点衣服就是送别时的全部。你，我，大家都是一样的，习惯了母亲的唠叨，却不知父亲爱的如此深沉，父爱如山，默默的给所有父亲们点个赞。<a id="more"></a><br>　　到这来我又不禁想起前几天的一个新闻，一女学生和父亲去买手机，姑娘执意要买iPhone6，父亲表情很无奈，看这位父亲的穿着并不像特别宽裕的，但最后还是买下了。全程父女两脸上没有一丝笑容。父亲跌坐在旁边发愁，孩子你这么那么不懂事啊！  </p>
<p><img src="http://ww2.sinaimg.cn/bmiddle/af5c6f4agw1enwj5o6bgjj20c80gaabf.jpg" alt="女儿"><br><img src="http://ww3.sinaimg.cn/bmiddle/af5c6f4agw1enwj5o8u91j20c80gawfq.jpg" alt="父亲"></p>
<embed src="http://player.video.qiyi.com/a4d4c96b81346087c45b21169ecd0304/0/0/w_19rse0yl8t.swf-albumId=2988474209-tvId=2988474209-isPurchase=0-cnId=25" allowfullscreen="true" quality="high" width="480" height="350" align="middle" allowscriptaccess="always" type="application/x-shockwave-flash">]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[使用mybatis的注意点]]></title>
      <url>http://twogoods.github.io/2014/12/30/12-30-mybatis/</url>
      <content type="html"><![CDATA[<ol>
<li>像mybatis,hibernate等等框架大量用到Java的反射，千万要在你的类中定义默认的构造方法</li>
<li>想这样含多个参数的方法 <code>public String[] getUserbh(String deptbh,String banzubh);</code>配置文件中可用0,1等序号或者将参数变成 <code>Map&lt;String,Object&gt; map</code></li>
</ol>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="keyword">select</span> id=<span class="string">"getUserbh"</span> parameterType=<span class="string">"String"</span> resultType=<span class="string">"String"</span>&gt;</span><br><span class="line">   <span class="keyword">select</span> usergh <span class="keyword">from</span> people <span class="keyword">where</span> deptbh= <span class="meta">#&#123;0&#125; and banzubh= #&#123;1&#125;</span></span><br><span class="line">&lt;/<span class="keyword">select</span>&gt;</span><br></pre></td></tr></table></figure>
<a id="more"></a>
<p>而这样是会报错的<br>(当然你可以用注解的方式让其准确<code>public String[] getUserbh(@Param(&quot;deptbh&quot;)String deptbh,@Param(&quot;banzubh&quot;)String banzubh);</code>)<br><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="keyword">select</span> id=<span class="string">"getUserbh"</span> parameterType=<span class="string">"String"</span> resultType=<span class="string">"String"</span>&gt;</span><br><span class="line">  <span class="keyword">select</span> usergh <span class="keyword">from</span> people <span class="keyword">where</span> deptbh= <span class="meta">#&#123;deptbh&#125; and banzubh= #&#123;banzubh&#125;</span></span><br><span class="line">&lt;/<span class="keyword">select</span>&gt;</span><br></pre></td></tr></table></figure></p>
<p>错误如下：<br>org.mybatis.spring.MyBatisSystemException: nested exception is org.apache.ibatis.binding.BindingException: Parameter ‘deptbh’ not found. Available parameters are [0, 1, param1, param2]　　<br>　3. mybatis中的动态SQL使用OGNL 的表达式<br><figure class="highlight dos"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="keyword">if</span> test="<span class="built_in">title</span> != null and <span class="built_in">title</span>!=''"&gt;</span><br><span class="line">       AND <span class="built_in">title</span> like #&#123;<span class="built_in">title</span>&#125;</span><br><span class="line">&lt;/<span class="keyword">if</span>&gt;</span><br></pre></td></tr></table></figure></p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[第一次尝试]]></title>
      <url>http://twogoods.github.io/2014/12/28/2014-12-28/</url>
      <content type="html"><![CDATA[<p>今天搞了一上午的博客，就弄了一点点东西。<br>这里是<a href="http://zipperary.com/" target="_blank" rel="external">教程</a>,当然更<a href="http://ijiaober.github.io/categories/hexo/" target="_blank" rel="external">详细</a>的在这。<br>hexo版本设计之后各模块都拆分出来，除了官网首页里列的一些命令：<br><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">npm <span class="keyword">install </span>hexo-cli -g</span><br><span class="line">hexo init <span class="keyword">blog</span><br><span class="line"></span>cd <span class="keyword">blog</span><br><span class="line"></span>npm <span class="keyword">install</span><br><span class="line"></span>hexo server</span><br></pre></td></tr></table></figure></p>
<p>还需<code>npm install hexo-deployer-git --save</code>安装提交到git的模块</p>
<h4 id="Markdown推荐Mweb，Quiver，作业部落这几个软件-多写就熟悉了"><a href="#Markdown推荐Mweb，Quiver，作业部落这几个软件-多写就熟悉了" class="headerlink" title="Markdown推荐Mweb，Quiver，作业部落这几个软件,多写就熟悉了"></a>Markdown推荐Mweb，Quiver，作业部落这几个软件,多写就熟悉了</h4><p><img src="http://ww2.sinaimg.cn/large/5e8cb366jw1e85r40u55hj20b40b4q2x.jpg" alt="ok。。。"></p>
]]></content>
    </entry>
    
  
  
</search>
